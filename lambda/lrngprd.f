      SUBROUTINE LRNGPRD(W,T,Q,SCR,DISSYW,NUMSYW,DISSYT,NUMSYT,
     &                  DISSYQ,NUMSYQ,LISTW,LISTT,IRREP,SPINAD,MAXCOR)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL SPINAD,MBPT4,BREDUNDANT
      LOGICAL MBPT2,MBPT3,M4DQ,M4SDQ,M4SDTQ,CCD,QCISD,CCSD,UCC,CC2
      INTEGER DISSYT,DISSYW,DISSYQ
c      DIMENSION W(DISSYW,NUMSYW),T(DISSYT,NUMSYT),Q(DISSYQ,NUMSYQ)
      DIMENSION W(numsyw*dissyw),T(numsyt*dissyt),Q(numsyq*dissyq)
      DIMENSION SCR(MAXCOR)
C
      COMMON/METH/MBPT2,MBPT3,M4DQ,M4SDQ,M4SDTQ,CCD,QCISD,CCSD,UCC,CC2
      COMMON /FLAGS2/IFLAGS2(500)
      COMMON /INFO/ NOCC(2),NVRTO(2)
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
C
      DATA TWO/2.D0/
      DATA AZERO,HALFM,ONE,ONEM /0.D0,-0.5D0,1.D0,-1.D0/

      BREDUNDANT = IFLAGS2(155).EQ.0

      IF (CC2) THEN
        CALL ZERO(Q, DISSYQ*NUMSYQ)
        RETURN
      ENDIF
C
C PICK UP THE RELEVANT T2 AND W PIECES.
C
c      IF(BREDUNDANT .OR. (LISTT.LT.134) .AND. (LISTT.GT.139))
c     & .OR. ((LISTT.LT.34) .AND. (LISTT.GT.39))) THEN
      IF(bRedundant) THEN
         CALL GETLST(T,1,NUMSYT,1,IRREP,LISTT)
      ELSE
         CALL GETLST_NR(T,SCR,MAXCOR*IINTFP,LISTT,IRREP)
      ENDIF
c

C 
C FOR RHF SPIN ADAPT THE L2 AMPLITUDES
C
      FACT=ONE
      IF(SPINAD) THEN
       LISTL=134
       IF(BREDUNDANT) THEN
          CALL GETLST(W,1,NUMSYT,1,IRREP,LISTL)
       ELSE
          CALL GETLST_NR(W,SCR,MAXCOR*IINTFP,LISTL,IRREP)
       ENDIF

       CALL SAXPY(NUMSYT*DISSYT,ONEM,W,1,T,1)
       MBPT4=M4DQ.OR.M4SDQ.OR.M4SDTQ
       FACT=HALFM
       IF(MBPT4) THEN
        LISTW2=23
        LISTW=18
       ELSE
        LISTW2=54
        LISTW=56
       ENDIF
      ENDIF
C
CSSS      IF(.NOT.BREDUNDANT.AND.MBPT4) THEN
CSSS         CALL GETLST_NR(W,SCR,MAXCOR*IINTFP,LISTW,IRREP)
CSSS      ELSE
         CALL GETLST(W,1,NUMSYW,2,IRREP,LISTW)
CSSS      ENDIF
C
C SPIN ADAPT W INTERMEDIATES
C
      IF(SPINAD) THEN
       CALL GETLST(Q,1,NUMSYW,2,IRREP,LISTW2)
       CALL SAXPY(NUMSYW*DISSYW,ONEM,Q,1,W,1)
      ENDIF
C
      CALL XGEMM('N','T',DISSYT,DISSYW,NUMSYW,FACT,T,DISSYT,
     &           W,DISSYW,AZERO,Q,DISSYQ)

      RETURN
      END

      SUBROUTINE FPMO(CMO,PCMO,UAIA,UAIB,SIJA,SIJB,
     &                IRREPX,IUHF)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER AOPOP,DIRPRD,POP,VRT
C
      DIMENSION CMO(1000),PCMO(1000),UAIA(100),UAIB(1),
     &          SIJA(100),SIJB(1)
      DIMENSION IOFFC(8)
C
      COMMON/AOOFST/INDOCC(8,2)
      COMMON/AOPOPS/AOPOP(8)
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON/SYMINF/NSTART,NIRREP,IRREPA(255,2),DIRPRD(8,8)
      COMMON/SYM/POP(8,2),VRT(8,2),NJUNK(6)
C
      DATA AZERO,ONE/0.D0,1.D0/
C
C  FIRST ALPHA SPIN CASE 
C
C LOOP OVER ALL IRREPS
C
      IOFFPC=1
      IOFFS=1
      IOFFU=1
C
      DO 100 IRREP1=1,NIRREP
C
       IRREP2=DIRPRD(IRREPX,IRREP1)
C
       NOCC1=POP(IRREP1,1)
       NOCC2=POP(IRREP2,1)
       NVRT2=VRT(IRREP2,1)
       NBAS2=AOPOP(IRREP2)
C
       IOFFCO=INDOCC(IRREP2,1)
       IOFFCV=IOFFCO+NBAS2*NOCC2
C
       CALL IZERO(PCMO(IOFFPC),IINTFP*NOCC1*NBAS2)
C
cYAU - wrapped for the new xgemm
       IF ( (NOCC2.NE.0) .AND. (NVRT2.NE.0) ) THEN
          CALL XGEMM('N','N',NBAS2,NOCC1,NOCC2,
     &               ONE,  CMO(IOFFCO), NBAS2,
     &                     SIJA(IOFFS), NOCC2,
     &               AZERO,PCMO(IOFFPC),NBAS2)
          CALL XGEMM('N','N',NBAS2,NOCC1,NVRT2,
     &               ONE,CMO(IOFFCV), NBAS2,
     &                   UAIA(IOFFU), NVRT2,
     &               ONE,PCMO(IOFFPC),NBAS2)
       END IF
C
       IOFFS=IOFFS+NOCC1*NOCC2 
       IOFFU=IOFFU+NOCC1*NVRT2
       IOFFPC=IOFFPC+NOCC1*NBAS2
C
100   CONTINUE
C
      IF(IUHF.EQ.1) THEN
C
C LOOP OVER ALL IRREPS
C
       IOFFS=1
       IOFFU=1
C
       DO 200 IRREP1=1,NIRREP
C
        IRREP2=DIRPRD(IRREPX,IRREP1)
C
        NOCC1=POP(IRREP1,2)
        NOCC2=POP(IRREP2,2)
        NVRT2=VRT(IRREP2,2)
        NBAS2=AOPOP(IRREP2)
C
        IOFFCO=INDOCC(IRREP2,2)
        IOFFCV=IOFFCO+NBAS2*NOCC2
C
        CALL IZERO(PCMO(IOFFPC),IINTFP*NOCC1*NBAS2)
C
        CALL XGEMM('N','N',NBAS2,NOCC1,NOCC2,ONE,CMO(IOFFCO),
     &             NBAS2,SIJB(IOFFS),NOCC2,AZERO,PCMO(IOFFPC),
     &             NBAS2)
        CALL XGEMM('N','N',NBAS2,NOCC1,NVRT2,ONE,CMO(IOFFCV),
     &             NBAS2,UAIB(IOFFU),NVRT2,ONE,PCMO(IOFFPC),
     &             NBAS2)
C
        IOFFS=IOFFS+NOCC1*NOCC2 
        IOFFU=IOFFU+NOCC1*NVRT2
        IOFFPC=IOFFPC+NOCC1*NBAS2
C
200    CONTINUE
C
      ENDIF
C
      RETURN
      END

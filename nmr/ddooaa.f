      SUBROUTINE DDOOAA(T1,T2,DDOO,FACT,ISPIN,POP,VRT,DISSYL, 
     &                  NUMSYL,DISSYR,NUMSYR,LISTT1,LISTT2,
     &                  LISTT3,IRREPL,IRREPR,IFLAG)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DISSYL,DISSYR,DIRPRD,POP,VRT
      DIMENSION T1(DISSYL,1),T2(DISSYR,1),DDOO(1),POP(8),VRT(8)
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD 
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),DIRPRD(8,8)
C
      DATA ONEM,ONE,HALF,TWO /-1.0D0,1.D0,0.5D0,2.0D0/ 
C 
C  PICK UP THE T1 AND T2 AMPLITUDES REQUIRED 
C  CHECK IFLAG WHAT TO DO
C
      CALL GETLST(T1,1,NUMSYL,1,IRREPL,LISTT1)
      CALL GETLST(T2,1,NUMSYR,2,IRREPR,LISTT2)
c       IF(IFLAG.EQ.3) THEN
c        CALL SSCAL(NUMSYT*DISSYT,TWO,T2,1)
c        CALL SAXPY(NUMSYT*DISSYT,ONEM,T1,1,T2,1)
c       ELSE IF(IFLAG.EQ.4) THEN
c        CALL SSCAL(NUMSYT*DISSYT,TWO,T1,1)
c        CALL SAXPY(NUMSYT*DISSYT,ONE,T2,1,T1,1)
c        CALL GETLST(T2,1,NUMSYT,2,IRREP,LISTT3)
c       ENDIF
C
C  EXPAND THE OCCUPIED-OCCUPIED BLOCK OF THE AMPLITUDES
C
      CALL SYMEXP(IRREPL,POP,DISSYL,T1)
      CALL SYMEXP(IRREPR,POP,DISSYR,T2)
C
C  PERFORM MULTIPLICATION
C
C  JOFF2 OFFSET IN THE OCCUPIED-OCCUPIED BLOCK OF T2
C  IOFF OFFSET IN DDOO
C
      JOFF2=1
      IOFF=1
C
      DO 90 IRREPJR=1,NIRREP
C          
C        GET OCCUPATION NUMBER FOR JRREP     
C
       NOCCJR=POP(IRREPJR)
C
C        DETERMINE IRREPI WHOSE DIRECT PRODUCT WITH JRREP GIVES IRREP
C
       IRREPI=DIRPRD(IRREPR,IRREPJR)
C
C        GET OCCUPATION NUMBER FOR IRREPIR
C
       NOCCI=POP(IRREPI)
C
       IRREPJL=DIRPRD(IRREPI,IRREPL)
C
       NOCCJL=POP(IRREPJL)
C
       JOFF1=1
       DO 89 IRREP=1,IRREPJL-1
        JOFF1=JOFF1+POP(IRREP)*POP(DIRPRD(IRREPL,IRREP))
89     CONTINUE
C
C IF NOCCI OR NOCCJR OR NOCCJL  EQUAL ZERO, NOTHING TO COMPUTE
C
       IF(MIN(NOCCJR,NOCCJL,NOCCI).NE.0) THEN
C
        CALL XGEMM('T','N',NOCCJL,NOCCJR,DISSYR*NOCCI,FACT,
     &              T1(1,JOFF1),NOCCI*DISSYL,T2(1,JOFF2),      
     &              NOCCI*DISSYR,ONE,DDOO(IOFF),NOCCJL)
C
       ENDIF
C
C UPDATE THE OFFSETS
C
       JOFF2=JOFF2+NOCCJR*NOCCI
       IOFF=IOFF+NOCCJL*NOCCJR
C
90    CONTINUE
C
      RETURN
      END

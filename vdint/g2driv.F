      SUBROUTINE G2DRIV(NHKT3,NHKT4,KHKT3,KHKT4,KHKT12,KHKT34,KH1234,
     *                  MHKT3,MHKT4,NORB3,NORB4,NUC3,NUC4,NSET3,NSET4,
     *                  NUC34,NORB12,NORB34,ISTEP3,ISTEP4,
     *                  TPRI34,TCON34,DIAG34,
     *                  PQSYM,IPQ0X,IPQ0Y,IPQ0Z,ID340X,ID340Y,ID340Z,
     *                  IPATH,MAXDER,DC2H,DC2E,CRSDER,DTEST,SEGMEN,
     *                  IPRINT,WORK1,LWORK1)
C
CEND
C
C  SEP/91 JG UNIVERSITY OF KARLSRUHE
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER AND,OR,XOR
C
      PARAMETER (LUCMD = 5, LUPRI = 6)
#include "baslims.par"
      LOGICAL DIAG34, PQSYM, PATH1, CRSDER, CROSS, DC2H, DC2E,
     *        PQSYMM, DTEST, DRTEST, SEGMEN, SEGCON,
     *        TPRI34, TCON34, TPRICD, TCONCD
      PARAMETER (MXQN=8, MXAQN=MXQN*(MXQN+1)/2, MXAQNS=MXAQN*MXAQN)
      DIMENSION LVALU3(MXAQN), MVALU3(MXAQN), NVALU3(MXAQN),
     *          LVALU4(MXAQN), MVALU4(MXAQN), NVALU4(MXAQN)
      DIMENSION WORK1(LWORK1)
      COMMON /INTADR/ IWKAO, IWKSO, IWKHHS, IWK1HH, IWK1HC, IWKLST
      COMMON /ODD12/  IODD12(MXAQN*MXAQN)
      COMMON /CC2INF/ KHKTAB, KHKTCD, KHABCD,
     *                NORBC, NORBD, NORBAB, NORBCD, NOABCD,
     *                TPRICD, TCONCD,
     *                JPQ0X, JPQ0Y, JPQ0Z, INCRMT, INCRMU, INCRMV,
     *                ISTRET, ISTREU, ISTREV, LVAL34, MVAL34, NVAL34,
     *                NCCPP, NUCC, NUCD, NUCCD, NSETC, NSETD,
     *                IADDPV, ISTRCF, IOFFVC, IODALL(MXAQN**2), PQSYMM,
     *                ICMP34, JPATH, PATH1, MAXDIF, CROSS, DRTEST,
     *                SEGCON, JPRINT
      IBTAND(I,J) = AND(I,J)
      IBTOR(I,J)  = OR(I,J)
      IBTSHL(I,J) = ISHFT(I,J)
      IBTSHR(I,J) = ISHFT(I,-J)
      IBTXOR(I,J) = XOR(I,J)
C
C     STRUCTURE OF HCINT:  KHKT12*NR34*NCCPP
C                  WORK:   KHKT12*NCCPP
C                  CCINT:  NORB34*NORB12*KHKT12*KHKT34
C                  CCGT0:  KHKT12
C
C  SET UP COMMON CC2INF 
C
      KHKTAB = KHKT12
      KHKTCD = KHKT34
      KHABCD = KH1234
      NORBC  = NORB3
      NORBD  = NORB4
      NORBAB = NORB12
      NORBCD = NORB34
      NOABCD = NORB12*NORB34
      TPRICD = TPRI34
      TCONCD = TCON34
      JPQ0X = IPQ0X
      JPQ0Y = IPQ0Y
      JPQ0Z = IPQ0Z
      INCRMT = ID340X + 1
      INCRMU = ID340Y + 1
      INCRMV = ID340Z + 1
      NCCPP = NORB12*NUC34
      NUCC  = NUC3
      NUCD  = NUC4
      NUCCD = NUC34
      NSETC = NSET3
      NSETD = NSET4
      MAXDIF = MAXDER
      CROSS = CRSDER
      PQSYMM = PQSYM
      DRTEST = DTEST
      SEGCON = SEGMEN
      JPATH = IPATH
      PATH1 = IPATH .EQ. 1
      IF (PATH1) THEN
       IADDPV = 0
       ISTRCF = 1
       IOFFVC = 0
      ELSE
       IADDPV = MXAOSQ
       ISTRCF = 1 - 2*MXCONT*MXAOVC
       IOFFVC =   - 2*MXAOVC
      END IF
      JPRINT = IPRINT
C
C IF NO SYMMETRY CLEAR IODALL 
C
      IF (.NOT.PQSYM) THEN
       DO 100 ICMP12 = 1, KHKT12
        IODALL(ICMP12) = 0
  100  CONTINUE
      ELSE
      END IF
C
C  Angular quantum numbers 
C
      CALL LMNVAL(NHKT3,MHKT3,LVALU3,MVALU3,NVALU3)
      CALL LMNVAL(NHKT4,MHKT4,LVALU4,MVALU4,NVALU4)
C
C  CALL INITIALIZATION ROUTINE
C
      CALL G2HINI(WORK1,LWORK1)
C
C  RUN OVER COMPONENTS IN THIS SHELL *****
C
      ICMP34 = 0
      DO 200 ICOMP3 = 1,KHKT3
         LVAL3 = LVALU3(ICOMP3)
         MVAL3 = MVALU3(ICOMP3)
         NVAL3 = NVALU3(ICOMP3)
         ISTRAT = ISTEP3*LVAL3
         ISTRAU = ISTEP3*MVAL3
         ISTRAV = ISTEP3*NVAL3
         IF (DIAG34) THEN
            MAX4 = ICOMP3
         ELSE
            MAX4 = KHKT4
         END IF
         DO 300 ICOMP4 = 1,MAX4
            ICMP34 = ICMP34 + 1
            LVAL4 = LVALU4(ICOMP4)
            MVAL4 = MVALU4(ICOMP4)
            NVAL4 = NVALU4(ICOMP4)
            LVAL34 = LVAL3 + LVAL4
            MVAL34 = MVAL3 + MVAL4
            NVAL34 = NVAL3 + NVAL4
            ISTRET = ISTRAT + ISTEP4*LVAL4
            ISTREU = ISTRAU + ISTEP4*MVAL4
            ISTREV = ISTRAV + ISTEP4*NVAL4
            IF (PQSYM) THEN
               IODD = IBTAND(LVAL34,IPQ0X)
               IODD = IBTOR(IBTSHL(IBTAND(MVAL34,IPQ0Y),1),IODD)
               IODD34 = IBTOR(IBTSHL(IBTAND(NVAL34,IPQ0Z),2),IODD)
               DO 400 I = 1, KHKT12
                  IODALL(I) = IBTXOR(IODD12(I),IODD34)
  400          CONTINUE
            END IF
C
            CALL G2HCAL(WORK1,LWORK1)
C
  300    CONTINUE
  200 CONTINUE
      RETURN
 1000 FORMAT (//,1X,'<<<<<<<<<< SUBROUTINE G2DRIV >>>>>>>>>>',/)
 1005 FORMAT (1X,'DC2H    ',L7)
 1006 FORMAT (1X,'DC2E    ',L7)
 1010 FORMAT (1X,'NHKT3/4 ',2I7)
 1020 FORMAT (1X,'KHKT3/4 ',2I7)
 1030 FORMAT (1X,'KHKT34  ',I7)
 1040 FORMAT (1X,'DIAG34  ',L7)
 1050 FORMAT (1X,'NORB34  ',I7)
 1060 FORMAT (1X,'NUC34   ',I7)
 1070 FORMAT (1X,'ID340:  ',3I7)
 1080 FORMAT (1X,'ISTEP3/4',2I7)
 1100 FORMAT (1X,'NCCPP   ',I7)
 1110 FORMAT (1X,'NO1234  ',I7)
 1120 FORMAT (1X,'IWKLST  ',I7)
 1220 FORMAT (1X,'LVALU3(KHKT3): ',(10I7))
 1230 FORMAT (1X,'MVALU3(KHKT3): ',(10I7))
 1240 FORMAT (1X,'NVALU3(KHKT3): ',(10I7))
 1250 FORMAT (1X,'LVALU4(KHKT4): ',(10I7))
 1260 FORMAT (1X,'MVALU4(KHKT4): ',(10I7))
 1270 FORMAT (1X,'NVALU4(KHKT4): ',(10I7))
      END

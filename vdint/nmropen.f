      SUBROUTINE NMROPEN
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DIRPRD
      LOGICAL EXIST
      LOGICAL IFIRST,IALL,XCOMP,YCOMP,ZCOMP
      CHARACTER*8 NAME
      CHARACTER*80 FNAME
C
      COMMON/BFILE/ IUNIT(3,8),NAME(3,8),EXIST(3,4)
      COMMON/PERT/NTPERT,NPERT(8),IIPERT(8),IXPERT,IYPERT,IZPERT,
     &            IXYPERT(3)
      COMMON/SYMINF/NSTART,NIRREP,IRREPA(255,2),DIRPRD(8,8)
      COMMON/TREATP/IFIRST,IALL,XCOMP,YCOMP,ZCOMP,IBF,IBL
C
      DO 1 I=1,4
       DO 1 J=1,3
        EXIST(J,I)=.FALSE.
1     CONTINUE
C
      IF(IXYPERT(1).EQ.1) THEN
       NAME(1,1)='IIIIX   '
       NAME(1,2)='IIJJX   '
       NAME(1,3)='IJIJX   '
       NAME(1,4)='IJKLX   '
      ELSE
       NAME(1,1)='IIIJX   '
       NAME(1,2)='IIJKX   '
       NAME(1,3)='IJIKX   '
       NAME(1,4)='IJKLX   '
      ENDIF
      IUNIT(1,1)=31
      IUNIT(1,2)=32
      IUNIT(1,3)=33
      IUNIT(1,4)=34
      IF(IXYPERT(2).EQ.1) THEN
       NAME(2,1)='IIIIY   '
       NAME(2,2)='IIJJY   '
       NAME(2,3)='IJIJY   '
       NAME(2,4)='IJKLY   '
      ELSE
       NAME(2,1)='IIIJY   '
       NAME(2,2)='IIJKY   '
       NAME(2,3)='IJIKY   '
       NAME(2,4)='IJKLY   '
      ENDIF
      IUNIT(2,1)=35
      IUNIT(2,2)=36
      IUNIT(2,3)=37
      IUNIT(2,4)=38
      IF(IXYPERT(3).EQ.1) THEN
       NAME(3,1)='IIIIZ   '
       NAME(3,2)='IIJJZ   '
       NAME(3,3)='IJIJZ   '
       NAME(3,4)='IJKLZ   '
      ELSE
       NAME(3,1)='IIIJZ   '
       NAME(3,2)='IIJKZ   '
       NAME(3,3)='IJIKZ   '
       NAME(3,4)='IJKLZ   '
      ENDIF
      IUNIT(3,1)=39
      IUNIT(3,2)=40
      IUNIT(3,3)=41
      IUNIT(3,4)=42
C     
C OPEN FILE FOR GIAO INTEGRAL DERIVATIVES 
C 
      IF(XCOMP) THEN
       CALL GFNAME(NAME(1,1),FNAME,ILENGTH)
       OPEN(UNIT=IUNIT(1,1),FILE=FNAME(1:ILENGTH),
     &      FORM='UNFORMATTED',
     &      STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
       EXIST(1,1)=.TRUE.
      ENDIF
      IF(YCOMP) THEN
       CALL GFNAME(NAME(2,1),FNAME,ILENGTH)
       OPEN(UNIT=IUNIT(2,1),FILE=FNAME(1:ILENGTH),
     &      FORM='UNFORMATTED',
     &      STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
       EXIST(2,1)=.TRUE.
      ENDIF
      IF(ZCOMP) THEN
       CALL GFNAME(NAME(3,1),FNAME,ILENGTH)
       OPEN(UNIT=IUNIT(3,1),FILE=FNAME(1:ILENGTH),
     &      FORM='UNFORMATTED',
     &      STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
       EXIST(3,1)=.TRUE.
      ENDIF
      IF(NIRREP.GT.1) THEN 
       IF(NIRREP.GT.2.OR.IXYPERT(1).EQ.1) THEN
        IF(XCOMP) THEN
        CALL GFNAME(NAME(1,2),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(1,2),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(1,2)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2.OR.IXYPERT(2).EQ.1) THEN
        IF(YCOMP) THEN
        CALL GFNAME(NAME(2,2),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(2,2),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(2,2)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2.OR.IXYPERT(3).EQ.1) THEN
        IF(ZCOMP) THEN
        CALL GFNAME(NAME(3,2),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(3,2),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(3,2)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2.OR.IXYPERT(1).EQ.1) THEN
        IF(XCOMP) THEN
        CALL GFNAME(NAME(1,3),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(1,3),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(1,3)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2.OR.IXYPERT(2).EQ.1) THEN
        IF(YCOMP) THEN
        CALL GFNAME(NAME(2,3),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(2,3),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(2,3)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2.OR.IXYPERT(3).EQ.1) THEN
        IF(ZCOMP) THEN
        CALL GFNAME(NAME(3,3),FNAME,ILENGTH)
        OPEN(UNIT=IUNIT(3,3),FILE=FNAME(1:ILENGTH),
     &       FORM='UNFORMATTED',
     &       STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
        EXIST(3,3)=.TRUE.
        ENDIF
       ENDIF
       IF(NIRREP.GT.2) THEN
        IF(NIRREP.GT.4.OR.IXYPERT(1).EQ.1) THEN
         IF(XCOMP) THEN
         CALL GFNAME(NAME(1,4),FNAME,ILENGTH)
         OPEN(UNIT=IUNIT(1,4),FILE=FNAME(1:ILENGTH),
     &        FORM='UNFORMATTED',
     &        STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
         EXIST(1,4)=.TRUE.
         ENDIF
        ENDIF
        IF(NIRREP.GT.4.OR.IXYPERT(2).EQ.1) THEN
         IF(YCOMP) THEN
         CALL GFNAME(NAME(2,4),FNAME,ILENGTH)
         OPEN(UNIT=IUNIT(2,4),FILE=FNAME(1:ILENGTH),
     &        FORM='UNFORMATTED',
     &        STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
         EXIST(2,4)=.TRUE.
         ENDIF
        ENDIF
        IF(NIRREP.GT.4.OR.IXYPERT(3).EQ.1) THEN
         IF(ZCOMP) THEN
         CALL GFNAME(NAME(3,4),FNAME,ILENGTH)
         OPEN(UNIT=IUNIT(3,4),FILE=FNAME(1:ILENGTH),
     &        FORM='UNFORMATTED',
     &        STATUS='UNKNOWN',ACCESS='SEQUENTIAL')
         EXIST(3,4)=.TRUE.
         ENDIF
        ENDIF
       ENDIF
      ENDIF
C
      RETURN
      END

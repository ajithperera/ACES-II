      SUBROUTINE T2INV1(ICORE,MAXCOR,IUHF,LISTV)
C
C  THIS ROUTINE IS THE DRIVER FOR THE CONTRIBUTION OF THE DOUBLES
C  TO THE SINGLES.
C  IT CALCULATES IN ADDITION THE FOURTH-ORDER SINGLE ENBERGY
C  CONTRIBUTION AND CALCULATES THE NEW T1-AMPLITUDES
C
CEND
C
C CODED JUNE/90  JG
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DIRPRD,POP1,POP2,VRT1,VRT2,LISTV
      LOGICAL LAMBDA,AOBASIS
      EQUIVALENCE(IFLAGS(2),METHOD)
      DIMENSION ICORE(MAXCOR)
      COMMON/SYM/ POP1(8),POP2(8),VRT1(8),VRT2(8),NTAA,NTBB,NF1AA,
     &            NF1BB,NF2AA,NF2BB
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /FILES/ LUOUT,MOINTS
      COMMON /FLAGS/ IFLAGS(100)
      COMMON /INFO/ NOCCO(2),NVRTO(2)
C
      COMMON/SYMINF/NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &DIRPRD(8,8)
      DATA ONE /1.0/
cjp
#include "bwcc.com"
C
C
C  FLAG IF LAMBDA OR CC EQUATIONS ARE SOLVED
C
      LAMBDA=.FALSE.
c      AOBASIS=IFLAGS(93).EQ.2
      aobasis = .false.
C
      NOCCA=NOCCO(1)
      NOCCB=NOCCO(2)
      NVRTA=NVRTO(1)
      NVRTB=NVRTO(2)
      NWAA=NTAA
      NWBB=NTBB
C
      ITAA=MAXCOR+1-NWAA*IINTFP
      MXCOR=MAXCOR-NWAA*IINTFP
      IF(IUHF.EQ.0) THEN
       ITBB=ITAA
      ELSE
       ITBB=ITAA-NWBB*IINTFP
       MXCOR=MXCOR-NWBB*IINTFP
      ENDIF
C
cjp
      CALL GETLST(ICORE(ITAA),1,1,1,1,LISTV)
      IF(IUHF.EQ.1) CALL GETLST(ICORE(ITBB),1,1,1,2,LISTV)

C
C  WITHIN THE SPIN ADAPTED RHF CODE NO CALL TO T2t1AA2 IS NECESSARY
C
      IF(IUHF.EQ.1) THEN
       CALL T2T1AA2(ICORE(ITAA),ICORE,MXCOR,POP1,VRT1,1,LAMBDA,0)
C
       CALL T2T1AA2(ICORE(ITBB),ICORE,MXCOR,POP2,VRT2,2,LAMBDA,0)
      ENDIF
C
C
      CALL T2T1AB2(ICORE(ITAA),ICORE,MXCOR,POP1,POP2,VRT1,VRT2,1,
     &             IUHF,LAMBDA,0)
C
      IF(IUHF.EQ.1) THEN
      CALL T2T1AB2(ICORE(ITBB),ICORE,MXCOR,POP2,POP1,VRT2,VRT1,2,
     &             IUHF,LAMBDA,0)
      ENDIF
C
C  WITHIN THE SPIN ADAPTED RHF CODE NO CALL TO T2T1AA1 IS NECESSARY
C
      IF(.NOT.AOBASIS) THEN
       IF(IUHF.EQ.1) THEN
        CALL T2T1AA1(ICORE(ITAA),ICORE,MXCOR,POP1,VRT1,1,LAMBDA,0)
C
        CALL T2T1AA1(ICORE(ITBB),ICORE,MXCOR,POP2,VRT2,2,LAMBDA,0)
       ENDIF
C
C
       CALL T2T1AB1(ICORE(ITAA),ICORE,MXCOR,POP1,POP2,VRT1,VRT2,1,
     &              IUHF,LAMBDA,0)
C
       IF(IUHF.EQ.1) THEN
       CALL T2T1AB1(ICORE(ITBB),ICORE,MXCOR,POP2,POP1,VRT2,VRT1,2,
     &              IUHF,LAMBDA,0)
       ENDIF
      ENDIF

      CALL PUTLST(ICORE(ITAA),1,1,1,1,LISTV)
      IF(IUHF.EQ.1) CALL PUTLST(ICORE(ITBB),1,1,1,2,LISTV)


      RETURN
      END

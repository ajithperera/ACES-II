      SUBROUTINE PCCD_H4ALL(ICORE,MAXCOR,SPCASE,IUHF)

      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER DIRPRD,DISSYG,DSSYT1A,DSSYT2A,DSSYT1B,DSSYT2B,
     &        DSSYT1,DSSYT2,DSSYT3A,DSSYT3B,DSSYT4A,DSSYT4B,
     &        DISSYG2  
      CHARACTER*4 SPCASE
      DIMENSION ICORE(MAXCOR)
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYM/ POP(8,2),VRT(8,2),NTAA,NTBB,NF1AA,NF1BB,NF2AA,NF2BB
      COMMON /FILES/ LUOUT,MOINTS
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &                DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),NTOT(18)
C
      DATA AZERO,HALF,ONE,ONEM,TWO /0.0D+0,0.5D0,1.0D+0,-1.D+0,2.D0/
C
       IF(SPCASE.EQ.'ABBA')THEN

       LISTG=156
       FACT=ONEM
       LIST1A=139
       LIST1B=137
       LIST2A=37
       LIST2B=39

       DO 200 IRREP=1,NIRREP 
        DSSYT1A=IRPDPD(IRREP,ISYTYP(1,LIST1A))
        DSSYT2A=IRPDPD(IRREP,ISYTYP(1,LIST2A))
        NMSYT1A=IRPDPD(IRREP,ISYTYP(2,LIST1A))
        NMSYT2A=IRPDPD(IRREP,ISYTYP(2,LIST2A))
        DSSYT1B=IRPDPD(IRREP,ISYTYP(1,LIST1B))
        DSSYT2B=IRPDPD(IRREP,ISYTYP(1,LIST2B))
        NMSYT1B=IRPDPD(IRREP,ISYTYP(2,LIST1B))
        NMSYT2B=IRPDPD(IRREP,ISYTYP(2,LIST2B))
        DISSYG=IRPDPD(IRREP,ISYTYP(1,LISTG))
        NUMSYG=IRPDPD(IRREP,ISYTYP(2,LISTG))
C
        I000=1
        I010=I000+IINTFP*DISSYG*NUMSYG
        I020=I010+IINTFP*NMSYT1A*DSSYT1A
        I030=I020+IINTFP*NMSYT2A*DSSYT2A
        I040=I030+IINTFP*NMSYT2A*DSSYT2A
        IF(I040 .GT. MAXCOR) CALL INSMEM('PCCD_H4ALL ',I040,MAXCOR)
        CALL IZERO(ICORE(I000),DISSYG*NUMSYG*IINTFP)

        CALL GETLST(ICORE(I020),1,NMSYT2A,1,IRREP,LIST2A)
        CALL GETLST(ICORE(I010),1,NMSYT1B,1,IRREP,LIST1A)
        CALL GETLST(ICORE(I030),1,NMSYT1A,1,IRREP,LIST1B)
        CALL DAXPY(NMSYT1A*DSSYT1A,ONEM,ICORE(I030),1,ICORE(I010),1)

        CALL XGEMM('N','N',DISSYG,NUMSYG,DSSYT2A,FACT,ICORE(I010),
     &             DSSYT1A,ICORE(I020),DSSYT2A,AZERO,ICORE(I000),
     &             DISSYG)
CSSS        call checksum("G1     :",ICORE(I000),NUMSYG*DISSYG)
C 
        I020=I010+IINTFP*NMSYT1B*DSSYT1B
        I030=I020+IINTFP*NMSYT2B*DSSYT2B
        I040=I030+IINTFP*NMSYT2B*DSSYT2B
        IF(MAXCOR.LT.I030) CALL INSMEM('PCCD_H4ALL ',I030,MAXCOR)
        CALL GETLST(ICORE(I020),1,NMSYT2A,1,IRREP,LIST2B)
        CALL GETLST(ICORE(I030),1,NMSYT2B,1,IRREP,LIST2A)
        CALL DAXPY(NMSYT2B*DSSYT2B,ONEM,ICORE(I030),1,ICORE(I020),1)
        CALL GETLST(ICORE(I010),1,NMSYT1B,1,IRREP,LIST1B)

        CALL XGEMM('N','N',DISSYG,NUMSYG,DSSYT2B,FACT,ICORE(I010),
     &              DSSYT1B,ICORE(I020),DSSYT2B,ONE,ICORE(I000),
     &              DISSYG)
C        call checksum("G2      :",ICORE(I000),NUMSYG*DISSYG)
C 
CSSS        I020=I010+IINTFP*NUMSYG*DISSYG
CSSS        IF(I020 .GT. MAXCOR) CALL INSMEM('PCCD_H4ALL ',I020,MAXCOR)
CSSS        CALL TRANSP(ICORE(I000),ICORE(I010),NUMSYG,DISSYG)
CSSS        CALL DAXPY(NUMSYG*DISSYG,ONE,ICORE(I010),1,ICORE(I000),1)

        CALL PUTLST(ICORE(I000),1,NUMSYG,2,IRREP,LISTG) 
CSSS        call checksum("List-56:",ICORE(I000),NUMSYG*DISSYG)

200    CONTINUE   
C
      ELSEIF(SPCASE.EQ.'ABAB')THEN
C
       LISTG=158
       LIST1=139
       LIST2=39
       FACT=ONEM
       ISAME=.FALSE.

       DO 300 IRREP=1,NIRREP 
        DSSYT1=IRPDPD(IRREP,ISYTYP(1,LIST1))
        DSSYT2=IRPDPD(IRREP,ISYTYP(1,LIST2))
        NMSYT1=IRPDPD(IRREP,ISYTYP(2,LIST1))
        NMSYT2=IRPDPD(IRREP,ISYTYP(2,LIST2))
        DISSYG=IRPDPD(IRREP,ISYTYP(1,LISTG))
        NUMSYG=IRPDPD(IRREP,ISYTYP(2,LISTG))
        I000=1
        I010=I000+IINTFP*DISSYG*NUMSYG
        I020=I010+IINTFP*NMSYT1*DSSYT1
        I030=I020+IINTFP*NMSYT2*DSSYT2
        IF(MAXCOR.LT.I030) CALL INSMEM('PCCD_H4ALL ',I030,MAXCOR)
        CALL IZERO(ICORE(I000),DISSYG*NUMSYG*IINTFP)

        CALL GETLST(ICORE(I010),1,NMSYT1,1,IRREP,LIST1)
        CALL GETLST(ICORE(I020),1,NMSYT2,1,IRREP,LIST2)
#ifdef _DEBUG_LVLM
        call checksum("T2     :",icore(i020),nmsyt2*dssyt2)
        call checksum("L2     :",icore(i010),nmsyt1*dssyt1)
#endif 
        CALL XGEMM('N','T',DISSYG,NUMSYG,NMSYT1,FACT,ICORE(I010),
     &             DSSYT1,ICORE(I020),DSSYT2,AZERO,ICORE(I000),DISSYG)
C
        CALL PUTLST(ICORE(I000),1,NUMSYG,2,IRREP,LISTG)
300    CONTINUE

      ENDIF

      RETURN
      END

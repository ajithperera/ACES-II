      SUBROUTINE PCCD_Q3AB(W,T,T1,Z,TMP,POP1,POP2,VRT1,VRT2,
     &                     NVRTSQ,DISSYW,DISSYT,NUMSYW,NUMSYT,
     &                     IRREP,FACT,IUHF,ISPIN)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DISSYT,DISSYW,DIRPRD,POP1,POP2,VRT1,VRT2
      DIMENSION W(NUMSYW,DISSYW),T(NUMSYT,DISSYT),Z(NVRTSQ)
      DIMENSION T1(DISSYW,NUMSYW)
      DIMENSION TMP(NUMSYT*DISSYT)
      DIMENSION POP1(8),POP2(8),VRT1(8),VRT2(8) 
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),DIRPRD(8,8)

      DATA ONE,ONEM,TWO,HALF /1.0D0,-1.0D0,2.0D0,0.5D0/

      FACTM=-FACT
      CALL GETLST(T1,1,NUMSYW,2,IRREP,16)
      CALL TRANSP(T1,W,NUMSYW,DISSYW)

      IF(IUHF.EQ.0) THEN
        CALL SPINAD1(IRREP,VRT1,NUMSYW,W,TMP,TMP(1+NUMSYW))
      ENDIF

      CALL GETLST(T1,1,NUMSYT,1,IRREP,46)
      CALL TRANSP(T1,T,NUMSYT,DISSYT)

      IF(IUHF.EQ.1.AND.ISPIN.EQ.1) THEN
        CALL SYMTR1(IRREP,VRT1,VRT2,NUMSYW,W,TMP,TMP(1+NUMSYW),
     &              TMP(1+2*NUMSYW))
        CALL SYMTR1(IRREP,VRT1,VRT2,NUMSYT,T,TMP,TMP(1+NUMSYT),
     &              TMP(1+2*NUMSYT))
      ENDIF

      IOFF=1
      JOFF=1
         DO 90 IRREPI=1,NIRREP
           NVRTI=VRT1(IRREPI)
           IF(NVRTI.EQ.0) GO TO 90

           IRREPJ=DIRPRD(IRREP,IRREPI)
           NVRTJ=VRT2(IRREPJ)
           IF(NVRTJ.EQ.0) GO TO 80

            CALL XGEMM('T','N',NVRTI,NVRTI,NUMSYW*NVRTJ,FACTM,
     &                  W(1,JOFF),NVRTJ*NUMSYW,T(1,JOFF),
     &                  NVRTJ*NUMSYT,ONE,Z(IOFF),NVRTI)

            JOFF=JOFF+NVRTJ*NVRTI
80         CONTINUE
           IOFF=IOFF+NVRTI**2
90        CONTINUE
C
      RETURN
      END

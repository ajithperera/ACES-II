      SUBROUTINE OS(ICORE,MAXCOR,IUHF,W)
C
C     THIS ROUTINE DRIVES THE CALCULATION OF THE EXTRA CONTRIBUTIONS
C     FOR OPEN SHELL SINGLETS
C
CEND
C
CPROGRAMED PS NOV 92
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DIRPRD,DISSYT
C
      DIMENSION ICORE(MAXCOR)
C
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &                DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),NTOT(18)
C
      INTEGER FSDPDAN,FSDPDNA,FSDPDAA,FSDPDIN,FSDPDNI,FSDPDII,FSDPDAI,
     $   FSDPDIA
      COMMON /FSSYMPOP/ FSDPDAN(8,22),FSDPDNA(8,22),FSDPDAA(8,22),
     &                  FSDPDIN(8,22),FSDPDNI(8,22),FSDPDII(8,22),
     &                  FSDPDAI(8,22),FSDPDIA(8,22)
C
      COMMON /ACTIRR/ IRREPOA,IRREPOB,IRREPVA,IRREPVB
C
      COMMON /FLAGS/ IFLAGS(100)
      DATA ONE,ONEM/1.D0,-1.D0/
C
C
C     FIRST GET THE 'EFFECTIVE HAMILTONIAN ELEMENT'
C
      LISTT2=63
      IRREP=DIRPRD(IRREPOA,IRREPOB)
      DISSYT=FSDPDAA(IRREP,ISYTYP(1,LISTT2))
      NUMSYT=FSDPDAA(IRREP,ISYTYP(2,LISTT2))
      IF(NUMSYT*DISSYT.NE.1) THEN
         WRITE(6,*)'@OS-E FATAL ERROR NUMSYT*DISSYT.NE.1',
     $      NUMSYT,DISSYT
         CALL ERREX
      ENDIF
      CALL FSGET(W,1,NUMSYT,1,IRREP,LISTT2,'AAAA')
      CALL PUTREC(20,'JOBARC','OSHEFFOF',IINTFP,W)
C
      WRITE(6,*)'@OS-M, W=',W
C     
C     T1 AND DISCONNECTED T2 CONTRIBUTIONS
C
C Terms 1-3 in Table 1 (and 6,7, term 1)
#ifdef _DEBUG_LVL0
      write(6,"(a)") " The AAII residual block before ost1 calls"
      call check_res(icore,maxcor,iuhf)
#endif 
      CALL OST1IA(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)

C Terms 1-3 in Table 1 (and 4,5, term 1)

C      CALL OST1AI(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
C Term3 
C      CALL OST1II(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
C
C     T2 CONTRIBUTIONS
C
C Terms 10 Table 1
      CALL OST2AAIA(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
C Term 11 in Table 1
      CALL OST2AIAA(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
#ifdef _DEBUG_LVL0
      write(6,"(a)") " The AAII residual block after ost1 calls"
      call check_res(icore,maxcor,iuhf)
#endif 
C Term 13 in Table 1
      CALL OST2IIAA(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
C Term 12 in Table 1 
      CALL OST2AAII(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)

C Term 14 in Table 1

      CALL OST2AIAI1(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)

C Term 15-16 in Table 1

      CALL OST2AIAI2(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)

C Term 4-6 in Table 1 (4-term3,4,6-term3,6-term4)

      CALL OST2IIAI1(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
      CALL OST2AIII1(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
      CALL OST2AIII2(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)

C Terms 8-9 in Table 1

      CALL OST2IIII1(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
      CALL OST2IIII2(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
      CALL OST2IIII3(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
      CALL OST2IIII4(ICORE,MAXCOR,IUHF,W,.FALSE.,DUMMY)
C
      RETURN
      END

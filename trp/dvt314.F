      SUBROUTINE DVT314(DVV,WC,WD,IADW,IRPIJK,ISPIN,NV)
      IMPLICIT INTEGER (A-Z)
      DOUBLE PRECISION DVV(NV),WC(1),WD(1)
#include "maxbasfn.par"
      DIMENSION IADW(8),COFF(8)
C
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     1                DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON /SYM/    POP(8,2),VRT(8,2),NTAA,NTBB,NF1AA,NF2AA,
     1                NF1BB,NF2BB
      COMMON /INFO/   NOCCO(2),NVRTO(2)
C
      COMMON /ACTORB/ ABSVRT(MAXBASFN,8,2),ABSOCC(MAXBASFN,8,2)
C
C     ROUTINE TO COMPUTE CONTRIBUTION OF T3 AAA OR T3 BBB TO DIAGONAL
C     ELEMENTS OF VIRTUAL-VIRTUAL BLOCK OF RELAXED DENSITY MATRIX.
C
C                           ABC   ABC
C     DVV(C,C) =    SUM    T     T
C                   A<B     IJK   IJK
C                  I<J<K
C
C     W IS (A<B,C) REPRESENTATION OF AAA OR BBB TRIPLES.
C
      DO   30 IRPC=1,NIRREP
      IF(VRT(IRPC,ISPIN).EQ.0) GOTO 30
      IRPAB = DIRPRD(IRPC,IRPIJK)
      DO   20    C=1,VRT(IRPC,ISPIN)
      CACT = ABSVRT(C,IRPC,ISPIN)
      DO   10   AB=1,IRPDPD(IRPAB,ISPIN)
      DVV(CACT) = DVV(CACT) + 
     1        WC(IADW(IRPC) + (C-1)*IRPDPD(IRPAB,ISPIN) + AB - 1) *
     1        WD(IADW(IRPC) + (C-1)*IRPDPD(IRPAB,ISPIN) + AB - 1)
   10 CONTINUE
   20 CONTINUE
   30 CONTINUE
C
      ITEST = 0
      IF(ITEST.EQ.0) RETURN
C
C     A LIKELY FASTER ALGORITHM. REPLACE INNER LOOPS BY SUBROUTINE
C     CALL FOR IMPROVEMENT.
C
      DO  130 IRPC=1,NIRREP
C
      IF(IRPC.EQ.1)THEN
      COFF(IRPC)  = 0
      ELSE
      COFF(IRPC)  = COFF(IRPC-1) + VRT(IRPC-1,ISPIN)
      ENDIF
C
      IF(VRT(IRPC,ISPIN).EQ.0) GOTO 130
C
      IRPAB = DIRPRD(IRPC,IRPIJK)
      DO  120    C=1,VRT(IRPC,ISPIN)
      DO  110   AB=1,IRPDPD(IRPAB,ISPIN)
      DVV(C + COFF(IRPC)) = DVV(C + COFF(IRPC)) + 
     1        WC(IADW(IRPC) + (C-1)*IRPDPD(IRPAB,ISPIN) + AB - 1) *
     1        WD(IADW(IRPC) + (C-1)*IRPDPD(IRPAB,ISPIN) + AB - 1)
  110 CONTINUE
  120 CONTINUE
  130 CONTINUE
C
      RETURN
      END

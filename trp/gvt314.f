      SUBROUTINE GVT314(W,ICORE,
     1                 IADW,
     1                 IRPI,IRPJ,IRPK,IRPIJ,IRPIK,IRPJK,IRPIJK,
     1                 I,J,K,ISPIN,LAMBDA)
      IMPLICIT INTEGER (A-Z)
      DOUBLE PRECISION TOL
      DOUBLE PRECISION W(1),ICORE(1)
      LOGICAL LAMBDA
      DIMENSION IADW(8)
      DIMENSION IADT2E(8),LENT2E(8),IADG(8),LENG(8)
C
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     1                DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON /SYM/    POP(8,2),VRT(8,2),NTAA,NTBB,NF1AA,NF2AA,
     1                NF1BB,NF2BB
      COMMON /INFO/   NOCCO(2),NVRTO(2)
      COMMON /FLAGS/  IFLAGS(100)
      EQUIVALENCE(ICLLVL,IFLAGS( 2))
      EQUIVALENCE(IDRLVL,IFLAGS( 3))
      EQUIVALENCE(IREFNC,IFLAGS(11))
C
      COMMON /GAMLIS/ LISGO1,LISGO2,LISGO3,LISGO4,LISGV1,LISGV2,
     1                LISGV3,LISGV4
      COMMON /T2ILIS/ LIST2I1,LIST2I2,LIST2I3
C
      COMMON /T3OFF/  IOFFVV(8,8,10),IOFFOO(8,8,10),IOFFVO(8,8,4)
C
      INDEX(I) = I*(I-1)/2
C     List offset
      IF (LAMBDA) THEN
         LISTOFF=100
      ELSE
         LISTOFF=0
      ENDIF
C
      IF(ISPIN.EQ.1)THEN
      LISGV = LISGV1
      ELSE
      LISGV = LISGV2
      ENDIF
C
C     ROUTINE TO COMPUTE CONTRIBUTION OF T3 AAA OR T3 BBB IN G(AI,BC) AAAA
C     OR BBBB. 
C
C                        BCD  DA
C     G(AI,BC) =   SUM  T    T
C                  J<K   IJK  JK
C                   D
C       AA AA            AAA  AA
C       BB BB            BBB  BB
C
C     W IS (B<C,D) REPRESENTATION OF T3 (B<C<D).
C
C     SET ADDRESSES FOR EXPANDED T2(D,A).
C
      DSZEXP = 0
      DO   10 IRPA=1,NIRREP
      IRPD = DIRPRD(IRPA,IRPJK)
      LENT2E(IRPA) = VRT(IRPA,ISPIN)*VRT(IRPD,ISPIN)
      DSZEXP = DSZEXP + LENT2E(IRPA)
      IF(IRPA.EQ.1)THEN
      IADT2E(IRPA) = 1
      ELSE
      IADT2E(IRPA) = IADT2E(IRPA-1) + LENT2E(IRPA-1)
      ENDIF
   10 CONTINUE
C
C     READ T2(D<A,J<K) AND EXPAND IN PLACE.
C
      IF(IRPJK.EQ.1)THEN
      JK = IOFFOO(IRPK,IRPJK,ISPIN) + INDEX(K-1) + J
      ELSE
      JK = IOFFOO(IRPK,IRPJK,ISPIN) + (K-1)*POP(IRPJ,ISPIN) + J
      ENDIF
      CALL GETLST(ICORE(1),JK,1,1,IRPJK,43+ISPIN+LISTOFF)
C
      DSZ = IRPDPD(IRPJK,ISPIN)
      CALL SYMEXP2(IRPJK,VRT(1,ISPIN),DSZEXP,DSZ,1,ICORE(1),ICORE(1))
C
C     SET ADDRESSES FOR GAMMA.
C
      IOFFG = IADT2E(NIRREP) + LENT2E(NIRREP)
      DO   20 IRPA=1,NIRREP
      IRPBC = DIRPRD(IRPA,IRPI)
      LENG(IRPA) = VRT(IRPA,ISPIN) * IRPDPD(IRPBC,ISPIN)
      IF(IRPA.EQ.1)THEN
      IADG(IRPA) = IOFFG
      ELSE
      IADG(IRPA) = IADG(IRPA-1) + LENG(IRPA-1)
      ENDIF
   20 CONTINUE
C
C     FORM CONTRIBUTION TO GAMMA (INITIALIZE HERE).
C
      DO   30 IRPD=1,NIRREP
      IRPA  = DIRPRD(IRPD,IRPJK)
      IF(VRT(IRPD,ISPIN).EQ.0.OR.LENG(IRPA).EQ.0) GOTO  30
      IRPBC = DIRPRD(IRPA,IRPI)
      IRPAI = DIRPRD(IRPA,IRPI)
      AI = IOFFVO(IRPI,IRPAI,ISPIN) + (I-1)*VRT(IRPA,ISPIN) + 1
      CALL GETLST(ICORE(IADG(IRPA)),
     1            AI,VRT(IRPA,ISPIN),2,IRPAI,LISGV)
      CALL XGEMM('N','N',IRPDPD(IRPBC,ISPIN),VRT(IRPA,ISPIN),
     1           VRT(IRPD,ISPIN), 1.0D+00,
     1           W(IADW(IRPD)),IRPDPD(IRPBC,ISPIN),
     1           ICORE(IADT2E(IRPA)),VRT(IRPD,ISPIN),
     1            1.0D+00,ICORE(IADG(IRPA)),IRPDPD(IRPBC,ISPIN))
      CALL PUTLST(ICORE(IADG(IRPA)),
     1            AI,VRT(IRPA,ISPIN),2,IRPAI,LISGV)
   30 CONTINUE
C
C                        BCD  DA
C     G(AJ,BC) = - SUM  T    T
C                  I<K   IJK  IK
C                   D
C       AA AA            AAA  AA
C       BB BB            BBB  BB
C
C     W IS (B<C,D) REPRESENTATION OF T3 (B<C<D).
C
C     SET ADDRESSES FOR EXPANDED T2(D,A).
C
      DSZEXP = 0
      DO  110 IRPA=1,NIRREP
      IRPD = DIRPRD(IRPA,IRPIK)
      LENT2E(IRPA) = VRT(IRPA,ISPIN)*VRT(IRPD,ISPIN)
      DSZEXP = DSZEXP + LENT2E(IRPA)
      IF(IRPA.EQ.1)THEN
      IADT2E(IRPA) = 1
      ELSE
      IADT2E(IRPA) = IADT2E(IRPA-1) + LENT2E(IRPA-1)
      ENDIF
  110 CONTINUE
C
C     READ T2(D<A,I<K) AND EXPAND IN PLACE.
C
      IF(IRPIK.EQ.1)THEN
      IK = IOFFOO(IRPK,IRPIK,ISPIN) + INDEX(K-1) + I
      ELSE
      IK = IOFFOO(IRPK,IRPIK,ISPIN) + (K-1)*POP(IRPI,ISPIN) + I
      ENDIF
      CALL GETLST(ICORE(1),IK,1,1,IRPIK,43+ISPIN+LISTOFF)
C
      DSZ = IRPDPD(IRPIK,ISPIN)
      CALL SYMEXP2(IRPIK,VRT(1,ISPIN),DSZEXP,DSZ,1,ICORE(1),ICORE(1))
C
C     SET ADDRESSES FOR GAMMA.
C
      IOFFG = IADT2E(NIRREP) + LENT2E(NIRREP)
      DO  120 IRPA=1,NIRREP
      IRPBC = DIRPRD(IRPA,IRPJ)
      LENG(IRPA) = VRT(IRPA,ISPIN) * IRPDPD(IRPBC,ISPIN)
      IF(IRPA.EQ.1)THEN
      IADG(IRPA) = IOFFG
      ELSE
      IADG(IRPA) = IADG(IRPA-1) + LENG(IRPA-1)
      ENDIF
  120 CONTINUE
C
C     FORM CONTRIBUTION TO GAMMA.
C
      DO  130 IRPD=1,NIRREP
      IRPA  = DIRPRD(IRPD,IRPIK)
      IF(VRT(IRPD,ISPIN).EQ.0.OR.LENG(IRPA).EQ.0) GOTO 130
      IRPBC = DIRPRD(IRPA,IRPJ)
      IRPAJ = DIRPRD(IRPA,IRPJ)
      AJ = IOFFVO(IRPJ,IRPAJ,ISPIN) + (J-1)*VRT(IRPA,ISPIN) + 1
      CALL GETLST(ICORE(IADG(IRPA)),
     1            AJ,VRT(IRPA,ISPIN),2,IRPAJ,LISGV)
      CALL XGEMM('N','N',IRPDPD(IRPBC,ISPIN),VRT(IRPA,ISPIN),
     1           VRT(IRPD,ISPIN),-1.0D+00,
     1           W(IADW(IRPD)),IRPDPD(IRPBC,ISPIN),
     1           ICORE(IADT2E(IRPA)),VRT(IRPD,ISPIN),
     1            1.0D+00,ICORE(IADG(IRPA)),IRPDPD(IRPBC,ISPIN))
      CALL PUTLST(ICORE(IADG(IRPA)),
     1            AJ,VRT(IRPA,ISPIN),2,IRPAJ,LISGV)
  130 CONTINUE
C
C                        BCD  DA
C     G(AK,BC) =   SUM  T    T
C                  I<J   IJK  IJ
C                   D
C       AA AA            AAA  AA
C       BB BB            BBB  BB
C
C     W IS (B<C,D) REPRESENTATION OF T3 (B<C<D).
C
C     SET ADDRESSES FOR EXPANDED T2(D,A).
C
      DSZEXP = 0
      DO  210 IRPA=1,NIRREP
      IRPD = DIRPRD(IRPA,IRPIJ)
      LENT2E(IRPA) = VRT(IRPA,ISPIN)*VRT(IRPD,ISPIN)
      DSZEXP = DSZEXP + LENT2E(IRPA)
      IF(IRPA.EQ.1)THEN
      IADT2E(IRPA) = 1
      ELSE
      IADT2E(IRPA) = IADT2E(IRPA-1) + LENT2E(IRPA-1)
      ENDIF
  210 CONTINUE
C
C     READ T2(D<A,I<J) AND EXPAND IN PLACE.
C
      IF(IRPIJ.EQ.1)THEN
      IJ = IOFFOO(IRPJ,IRPIJ,ISPIN) + INDEX(J-1) + I
      ELSE
      IJ = IOFFOO(IRPJ,IRPIJ,ISPIN) + (J-1)*POP(IRPI,ISPIN) + I
      ENDIF
      CALL GETLST(ICORE(1),IJ,1,1,IRPIJ,43+ISPIN+LISTOFF)
C
      DSZ = IRPDPD(IRPIJ,ISPIN)
      CALL SYMEXP2(IRPIJ,VRT(1,ISPIN),DSZEXP,DSZ,1,ICORE(1),ICORE(1))
C
C     SET ADDRESSES FOR GAMMA.
C
      IOFFG = IADT2E(NIRREP) + LENT2E(NIRREP)
      DO  220 IRPA=1,NIRREP
      IRPBC = DIRPRD(IRPA,IRPK)
      LENG(IRPA) = VRT(IRPA,ISPIN) * IRPDPD(IRPBC,ISPIN)
      IF(IRPA.EQ.1)THEN
      IADG(IRPA) = IOFFG
      ELSE
      IADG(IRPA) = IADG(IRPA-1) + LENG(IRPA-1)
      ENDIF
  220 CONTINUE
C
C     FORM CONTRIBUTION TO GAMMA.
C
      DO  230 IRPD=1,NIRREP
      IRPA  = DIRPRD(IRPD,IRPIJ)
      IF(VRT(IRPD,ISPIN).EQ.0.OR.LENG(IRPA).EQ.0) GOTO 230
      IRPBC = DIRPRD(IRPA,IRPK)
      IRPAK = DIRPRD(IRPA,IRPK)
      AK = IOFFVO(IRPK,IRPAK,ISPIN) + (K-1)*VRT(IRPA,ISPIN) + 1
      CALL GETLST(ICORE(IADG(IRPA)),
     1            AK,VRT(IRPA,ISPIN),2,IRPAK,LISGV)
      CALL XGEMM('N','N',IRPDPD(IRPBC,ISPIN),VRT(IRPA,ISPIN),
     1           VRT(IRPD,ISPIN), 1.0D+00,
     1           W(IADW(IRPD)),IRPDPD(IRPBC,ISPIN),
     1           ICORE(IADT2E(IRPA)),VRT(IRPD,ISPIN),
     1            1.0D+00,ICORE(IADG(IRPA)),IRPDPD(IRPBC,ISPIN))
      CALL PUTLST(ICORE(IADG(IRPA)),
     1            AK,VRT(IRPA,ISPIN),2,IRPAK,LISGV)
  230 CONTINUE
C
      RETURN
      END

         
      SUBROUTINE SDINVOC(IRREPX,IVO,DOO,ICORE,MXCOR,IUHF)
C
C THIS ROUTINE COMPUTES THE CONTRIBUTIONS:
C
C      FD(A,I) = - 1/2 SUM SD(N,M) * (<AM||IN> - <AN||IM>)     (ISPIN=1)
C
C      FD(a,i) = - 1/2 SUM SD(n,m) * (<am||in> - <an||im>)     (ISPIN=2)
C
C NOTE THAT THIS ROUTINE DEALS WITH COMPLEX PERTURBATIONS AND
C THAT SD(M,N) IS THEREFORE ANTISYMMETRIC
C
CEND
C 
C HACKED UP FROM SDINVO SEP/91 JG UNIVERSITY OF KARLSRUHE
C
      IMPLICIT INTEGER (A-Z)
      CHARACTER*4 TYPE
      DOUBLE PRECISION IVO,DOO,ONE,ONEM
      DIMENSION DOO(1),IVO(10000),ICORE(MXCOR)
      COMMON /SYM/ POP(8,2),VRT(8,2),NT(2),NFMI(2),NFEA(2)
      COMMON /SYMINF/ NSTART,NIRREP,IRREPS(255,2),DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
C
      DATA ONE,ONEM /1.0D0,-1.0D0/
C
      IF(IUHF.EQ.0)THEN
C
C SPIN ADAPTED RHF CODE
C
C   FOR CLOSED SHELLS THE TASK CAN BE REDUCED TO
C
C      S(N,M) <Am||Ni>
C
       LISTW=10
C
       DISSIZ=IRPDPD(IRREPX,ISYTYP(1,LISTW))
       NUMDIS=IRPDPD(IRREPX,ISYTYP(2,LISTW))
C
       I000=1
       I010=I000+IINTFP*NUMDIS*DISSIZ
       IF((I010+3*IINTFP*DISSIZ).GE.MXCOR) CALL ERREX
C
       CALL GETLST(ICORE(I000),1,NUMDIS,1,IRREPX,LISTW)
       CALL SYMTR1(IRREPX,POP(1,1),VRT(1,1),DISSIZ,ICORE(I000),
     &             ICORE(I010),ICORE(I010+IINTFP*DISSIZ),
     &             ICORE(I010+2*IINTFP*DISSIZ))
C
       CALL XGEMM('N','N',1,NUMDIS,DISSIZ,ONEM,DOO,1,ICORE(I000),
     &            DISSIZ,ONE,IVO,1)
C 
      ELSEIF(IUHF.NE.0)THEN
C
       call errex
C
C please check and coorect
C
       DO 10 ISPIN=1,2
C
        LISTW=6+ISPIN
C
        DO 20 IRREP=1,NIRREP
         NDSZ1=IRPDPD(IRREP,ISYTYP(1,LISTW))
         NDIS1=IRPDPD(IRREP,ISYTYP(2,LISTW))
         NDSZF=IRPDPD(IRREP,20+ISPIN)
         IOFFI=1+(ISPIN-1)*IRPDPD(IRREPX,9)
C
C DO   SD(m,n) * I(ma,ni)
C
         I000=1
         I010=I000+IINTFP*NDSZF*NDIS1
         I015=I010+IINTFP*NDSZ1*NDIS1
         I020=I015+IINTFP*IRPDPD(IRREPX,18+ISPIN)
         IOFFD=1+(ISPIN-1)*IRPDPD(IRREPX,21)
C
         CALL GETLST(ICORE(I010),1,NDIS1,2,IRREP,LISTW)
         CALL TRANSP(ICORE(I010),ICORE(I000),NDIS1,NDSZ1)
         CALL SYMEXP(IRREP,POP(1,ISPIN),NDIS1,ICORE(I000))
         CALL DDOT24(IRREPX,IRREP,IVO(IOFFI),DOO(IOFFD),ICORE(I000),
     &              ICORE(I010),NDIS1,VRT(1,ISPIN),POP(1,ISPIN),
     &              POP(1,ISPIN),VRT(1,ISPIN),POP(1,ISPIN),POP(1,ISPIN),
     &             'STST')
C
20      CONTINUE
C
10     CONTINUE
C
      ENDIF
C
C ALL DONE
C
      RETURN
      END

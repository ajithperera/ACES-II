      SUBROUTINE OST2IIII3(ICORE,MAXCOR,IUHF,W,LAMBDA,WL)
C
C
C   THIS ROUTINE CALCULATE INACTIVE,INACTIVE-INACTIVE,INACTIVE T2 CONTRIBUTION
C
C   T2(IJ,CD) <-- T2(CI,DJ)=-W*TAU(ni,mc)*T2(Mj,Nd)   + four permutation
C   T2(ij,cd) <-- T2(ci,dj)=-W*TAU(MI,NC)*T2(Jn,Dm)   + four permutation
C   T2(Ij,Cd) <-- T2(CI,dj)=-W*[T2(ni,mc)*T2(MJ,ND)-T1(nc)T1(im)T(MJ,ND)
C                               -T2(ni,mc)T1(JN)T1(MD)]
C                           -W*T2(Mi,Nc)*T2(Jn,Dm)
C             <-- T2(Cj,dI)=-W*[T2(Jn,Nc)*T2(Mi,Dm)-T1(JN)T1(nc)T2(Mi,Dm)
C                               T2(Jn,Nc)T1(MD)T1(im)]
C
CEND
C
CPROGRAMED PS NOV/92
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DIRPRD,DISSYT,POP,VRT,DISSYT2,DISSYT1,DISSYTAR
      CHARACTER*4 STRING
      LOGICAL LAMBDA
C
      DIMENSION ICORE(MAXCOR)
C
      COMMON /INFO/ NOCCO(2),NVRTO(2)
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &                DIRPRD(8,8)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),NTOT(18)
      COMMON /SYM/ POP(8,2),VRT(8,2),NT(2),NF1(2),NF2(2)
C
      INTEGER POPA,POPI,VRTA,VRTI
      COMMON /FSSYM/ POPA(8,2),POPI(8,2),VRTA(8,2),VRTI(8,2),
     &               NTAN(2),NTNA(2),NTAA(2),
     &               NTIN(2),NTNI(2),NTII(2),
     &               NTAI(2),NTIA(2),
     &               NF1AN(2),NF1AA(2),NF1IN(2),NF1II(2),NF1AI(2),
     &               NF2AN(2),NF2AA(2),NF2IN(2),NF2II(2),NF2AI(2)
C
      INTEGER FSDPDAN,FSDPDNA,FSDPDAA,FSDPDIN,FSDPDNI,FSDPDII,FSDPDAI,
     $   FSDPDIA
      COMMON /FSSYMPOP/ FSDPDAN(8,22),FSDPDNA(8,22),FSDPDAA(8,22),
     &                  FSDPDIN(8,22),FSDPDNI(8,22),FSDPDII(8,22),
     &                  FSDPDAI(8,22),FSDPDIA(8,22)
C
      COMMON /ACTIRR/ IRREPOA,IRREPOB,IRREPVA,IRREPVB
C
      COMMON /FLAGS/ IFLAGS(100)
C
      DATA ONE,ONEM,ZILCH,HALFM,TWOM,TWO/1.D0,-1.D0,0.D0,-0.5D0,-2.D0,
     $   2.D0/
C
      IF((IRREPOA*IRREPOB*IRREPVA*IRREPVB.EQ.0).OR.(IRREPOA.NE.IRREPVB)
     $   .OR.(IRREPOB.NE.IRREPVA)) THEN
         WRITE(6,*)'@OST2IIII3-E FATAL ERROR, ',
     $      'IRREPOA,IRREPOB,IRREPVA,IRREPVB',
     $      IRREPOA,IRREPOB,IRREPVA,IRREPVB
         CALL ERREX
      ENDIF
C
C     ZERO SCRATCH LISTS
C
      CALL ZEROLIST(ICORE,MAXCOR,40)
      CALL ZEROLIST(ICORE,MAXCOR,41)
      CALL ZEROLIST(ICORE,MAXCOR,42)
      CALL ZEROLIST(ICORE,MAXCOR,43)
C
C     NOW CONSIDER THE DIFFERENT SPINCASES
C
C     AAAA   SPINCASE
C
      CALL OST2I3(ICORE,MAXCOR,IRREPOB,IRREPVB,IRREPVA,IRREPOA,45,46,
     $   POPI(1,2),POPI(1,2),VRTI(1,2),VRTI(1,2),'AIAI','AIAI',
     $   40,ONEM*W,ZILCH,ONEM,ZILCH,IEX)
      IF(IEX.EQ.0) GOTO 10
C
C     RESORT AND ANTISYMMETRIZE T2 INCREMENT, AND THEN AUGMENT THE 
C     T2 INCREMENT LIST. 
C
      NTOTSZ=ISYMSZ(ISYTYP(1,40),ISYTYP(2,40))
      NTOTSZ2=ISYMSZ(ISYTYP(1,61),ISYTYP(2,61))
      NOCC=NOCCO(1)
      NVRT=NVRTO(1)
      NVSIZ=(NVRT*(NVRT-1))/2
      NOSIZ=(NOCC*(NOCC-1))/2
      ISCRSZ=NVSIZ+NOSIZ+NOCC*NVRT
C
C    I000: T2(IN)   I010:  T2(OUT)    I020:  SCR
C
      I000=1
      I010=I000+MAX(NTOTSZ,NTOTSZ2)*IINTFP
      I020=I010+MAX(NTOTSZ,NTOTSZ2)*IINTFP
      I030=I020+ISCRSZ
      CALL GETALL(ICORE(I000),NTOTSZ,1,40)
      CALL SST03I(ICORE(I000),ICORE(I010),NTOTSZ,NTOTSZ2,ICORE(I020),
     $   'AAAA')
      IF(.NOT.LAMBDA) THEN
         CALL GETALL(ICORE(I000),NTOTSZ2,1,61)
         CALL SAXPY(NTOTSZ2,ONE,ICORE(I010),1,ICORE(I000),1)
         CALL PUTALL(ICORE(I000),NTOTSZ2,1,61)
      ELSE
         CALL GETALL(ICORE(I000),NTOTSZ2,1,144)
         WL=WL+SDOT(NTOTSZ2,ICORE(I000),1,ICORE(I010),1)
      ENDIF
 10   CONTINUE
C
C     BBBB   SPINCASE
C
      CALL OST2I3(ICORE,MAXCOR,IRREPOA,IRREPVA,IRREPVB,IRREPOB,44,46,
     $   POPI(1,1),POPI(1,1),VRTI(1,1),VRTI(1,1),'AIAI','IAIA',
     $   41,ONEM*W,ZILCH,ONEM,ZILCH,IEX)
      IF(IEX.EQ.0) GOTO 20
C
C     RESORT AND ANTISYMMETRIZE T2 INCREMENT, AND THEN AUGMENT THE 
C     T2 INCREMENT LIST. 
C
      NTOTSZ=ISYMSZ(ISYTYP(1,41),ISYTYP(2,41))
      NTOTSZ2=ISYMSZ(ISYTYP(1,62),ISYTYP(2,62))
      NOCC=NOCCO(2)
      NVRT=NVRTO(2)
      NVSIZ=(NVRT*(NVRT-1))/2
      NOSIZ=(NOCC*(NOCC-1))/2
      ISCRSZ=NVSIZ+NOSIZ+NOCC*NVRT
C
C    I000: T2(IN)   I010:  T2(OUT)    I020:  SCR
C
      I000=1
      I010=I000+MAX(NTOTSZ,NTOTSZ2)*IINTFP
      I020=I010+MAX(NTOTSZ,NTOTSZ2)*IINTFP
      I030=I020+ISCRSZ
      CALL GETALL(ICORE(I000),NTOTSZ,1,41)
      CALL SST03I(ICORE(I000),ICORE(I010),NTOTSZ,NTOTSZ2,ICORE(I020),
     $   'BBBB')
      IF(.NOT.LAMBDA) THEN
         CALL GETALL(ICORE(I000),NTOTSZ2,1,62)
         CALL SAXPY(NTOTSZ2,ONE,ICORE(I010),1,ICORE(I000),1)
         CALL PUTALL(ICORE(I000),NTOTSZ2,1,62)
      ELSE
         CALL GETALL(ICORE(I000),NTOTSZ2,1,145)
         WL=WL+SDOT(NTOTSZ2,ICORE(I000),1,ICORE(I010),1)
      ENDIF
 20   CONTINUE
C
C     ABAB   SPINCASE FIRST TWO TERM
C
      CALL OST2I3(ICORE,MAXCOR,IRREPOB,IRREPVB,IRREPVA,IRREPOA,45,44,
     $   POPI(1,2),POPI(1,1),VRTI(1,2),VRTI(1,1),'AIAI','AIAI',
     $   42,HALFM*W,ZILCH,TWOM,ZILCH,IEX1)
      CALL OST2I3(ICORE,MAXCOR,IRREPOB,IRREPVB,IRREPVA,IRREPOA,45,44,
     $   POPI(1,2),POPI(1,1),VRTI(1,2),VRTI(1,1),'AIAI','AIAI',
     $   42,HALFM*W,ONE,ZILCH,TWOM,IEX1)
      IF(IEX1.EQ.0) THEN
         FACT=ZILCH
      ELSE
         FACT=ONE
      ENDIF
      CALL OST2I3(ICORE,MAXCOR,IRREPOA,IRREPVA,IRREPVB,IRREPOB,46,46,
     $   POPI(1,2),POPI(1,1),VRTI(1,2),VRTI(1,1),'AIAI','IAIA',
     $   42,ONEM*W,FACT,ZILCH,ZILCH,IEX2)
      CALL OST2I3(ICORE,MAXCOR,IRREPOB,IRREPVA,IRREPVB,IRREPOA,46,46,
     $   POPI(1,1),POPI(1,2),VRTI(1,2),VRTI(1,1),'AIIA','IAAI',
     $   43,HALFM*W,ZILCH,TWO,ZILCH,IEX3)
      CALL OST2I3(ICORE,MAXCOR,IRREPOB,IRREPVA,IRREPVB,IRREPOA,46,46,
     $   POPI(1,1),POPI(1,2),VRTI(1,2),VRTI(1,1),'AIIA','IAAI',
     $   43,HALFM*W,ONE,ZILCH,TWO,IEX3)
C
C     RESORT AND ANTISYMMETRIZE T2 INCREMENT, AND THEN AUGMENT THE 
C     T2 INCREMENT LIST. 
C
      NTOTSZ=ISYMSZ(ISYTYP(1,42),ISYTYP(2,42))
      NTOTSZ1=ISYMSZ(ISYTYP(1,43),ISYTYP(2,43))
      NTOTSZ2=ISYMSZ(ISYTYP(1,63),ISYTYP(2,63))
      NOCCA=NOCCO(1)
      NOCCB=NOCCO(2)
      NVRTA=NVRTO(1)
      NVRTB=NVRTO(2)
      ISCRSZ=(NOCCA+NOCCB)*(NVRTA*NVRTB)
C
C    I000: T2(IN)   I010:  T2(OUT)    I020:  T2    I030:   SCR
C
      I000=1
      I010=I000+MAX(NTOTSZ,NTOTSZ2)*IINTFP
      I020=I010+MAX(NTOTSZ,NTOTSZ2,NTOTSZ1)*IINTFP
      I030=I020+MAX(NTOTSZ,NTOTSZ2,NTOTSZ1)*IINTFP
      I040=I030+ISCRSZ
      IF(I040.GT.MAXCOR)CALL INSMEM('OST2IIII3',I040,MAXCOR)
      IF(IEX1.NE.0.OR.IEX2.NE.0) THEN
        CALL GETALL(ICORE(I000),NTOTSZ,1,42)
        CALL SST02I(ICORE(I000),ICORE(I010),NTOTSZ,NTOTSZ2,ICORE(I030),
     $      'AABB')
        IF(.NOT.LAMBDA) THEN
           CALL GETALL(ICORE(I000),NTOTSZ2,1,63)
           CALL SAXPY(NTOTSZ2,ONE,ICORE(I010),1,ICORE(I000),1)
        ELSE
           CALL GETALL(ICORE(I000),NTOTSZ2,1,146)
           WL=WL+SDOT(NTOTSZ2,ICORE(I000),1,ICORE(I010),1)
      ENDIF
      ELSE IF(IEX3.NE.0) THEN
         IF(.NOT.LAMBDA) THEN
            CALL GETALL(ICORE(I000),NTOTSZ2,1,63)
         ELSE
            CALL GETALL(ICORE(I000),NTOTSZ2,1,146)
         ENDIF
      ELSE
        RETURN
      ENDIF
      IF(IEX3.NE.0) THEN
        CALL GETALL(ICORE(I010),NTOTSZ1,1,43)
        CALL SSTGEN(ICORE(I010),ICORE(I020),NTOTSZ1,VRT(1,1),POP(1,2),
     $      VRT(1,2),POP(1,1),ICORE(I030),1,'1432')
        CALL SST02I(ICORE(I020),ICORE(I010),NTOTSZ1,NTOTSZ2,ICORE(I030),
     $     'AABB')
        IF(.NOT.LAMBDA) THEN
           CALL SAXPY(NTOTSZ2,ONE,ICORE(I010),1,ICORE(I000),1)
        ELSE
           WL=WL+SDOT(NTOTSZ2,ICORE(I000),1,ICORE(I010),1)
        ENDIF
      ENDIF
      IF(.NOT.LAMBDA) THEN
         CALL PUTALL(ICORE(I000),NTOTSZ2,1,63)
      ENDIF
C     
      RETURN
      END

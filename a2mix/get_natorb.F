      SUBROUTINE GET_NATORB(SCR1,SCR2,SCR3,SCR4,SCR5,IORDR,XOCC,
     &                      NBAS,NBASP,ISPIN,IUHF)

      IMPLICIT DOUBLE PRECISION(A-H,O-Z)

      DIMENSION SCR1(NBASP*NBAS),SCR2(NBAS),SCR3(NBASP,NBAS)
      DIMENSION SCR4(NBASP,NBAS),SCR5(NBASP)
      DIMENSION XOCC(NBASP,2)
      DIMENSION IORDR(NBASP)

      CHARACTER*1 TYPE(2)

      DATA TYPE/"A","B"/

#include "machsp.com"

      FCTR = 1.0D0
      IF (IUHF .EQ. 0) FCTR=0.50D0
      CALL GETREC(20,"JOBARC","AONTORB"//TYPE(ISPIN),NBAS*NBAS*IINTFP,
     &            SCR1)
      CALL GETREC(20,"JOBARC","OCCNUM_"//TYPE(ISPIN),NBAS*IINTFP,SCR2)
      CALL GETREC(20,"JOBARC","CMP2ZMAT",NBAS*NBASP*IINTFP,SCR3)
      CALL DGEMM("N","N",NBASP,NBAS,NBAS,1.0D0,SCR3,NBASP,SCR1,
     &           NBAS,0.0D0,SCR4,NBASP)
      CALL GETREC(20,"JOBARC","SCFEVL"//TYPE(ISPIN)//"0",NBASP*IINTFP,
     &            SCR5)

      DO IMO = 1, NBASP
         IORDR(IMO) = IMO
      ENDDO
      CALL PIKSR2(NBASP,SCR5,IORDR)

      DO IMO = 1, NBASP
          XOCC(IMO,ISPIN) = FCTR*SCR2(IORDR(IMO))
          IFROM = IORDR(IMO)
          CALL DCOPY(NBASP,SCR4(1,IFROM),1,SCR3(1,IMO),1)
      ENDDO

      CALL PUTREC(20,"JOBARC","CORR_EV"//TYPE(ISPIN),NBAS*NBASP*IINTFP,
     &            SCR3)

      RETURN
      END 

      

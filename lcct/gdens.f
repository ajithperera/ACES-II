      SUBROUTINE GDENS(IRREPXL,IRREPXR,IRREPX,DOO,DVV,DVO,DOV,SCR,MXCOR,
     &   IUHF,ZNORM,LISTGRL,LISTGTL,LISTGRLOF,LISTGTLOF,LISTTMP,
     &   LISTTMPOF,LISTR1,LISTL1,LISTR1OFF,LISTL1OFF,LISTR2,LISTL2,
     &   LISTR2RS,LISTL2RS,LISTT1,LISTT1OFF,NONHF)
C
C DRIVER FOR FORMATION OF GENERAL ONE-PARTICLE REDUCED DENSITY MATRIX
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      logical nonhf
      DOUBLE PRECISION L0
      DIMENSION SCR(MXCOR),LENVV(2),LENOO(2),LENVO(2)
      DIMENSION DOO(*),DVV(*),DVO(*),DOV(*)
      COMMON/SYMPOP/IRPDPD(8,22),ISYTYP(2,500),ID(18)
C
      DATA ONE,ONEM,ZILCH /1.0d0,-1.0D0,0.0d0/
C
C DO SOME ACCOUNTING AND SET UP ADDRESSES
C
      CALL IZERO(LENVV,2)
      CALL IZERO(LENOO,2)
      CALL IZERO(LENVO,2)
      DO 10 ISPIN=1,1+IUHF
       LENVV(ISPIN)=IRPDPD(IRREPX,18+ISPIN)
       LENOO(ISPIN)=IRPDPD(IRREPX,20+ISPIN)
       LENVO(ISPIN)=IRPDPD(IRREPX, 8+ISPIN)
10    CONTINUE
C
C INITIALIZE THE DENSITY MATRIX.
C
      CALL ZERO(DOO,LENOO(1)+IUHF*LENOO(2))
      CALL ZERO(DVV,LENVV(1)+IUHF*LENVV(2))
      CALL ZERO(DVO,LENVO(1)+IUHF*LENVO(2))
      CALL ZERO(DOV,LENVO(1)+IUHF*LENVO(2))
C
C                      +
C NOW CALCULATE <0|L {p q exp(T)} R_n|0> CONTRIBUTIONS TO THE
C DENSITY, WHERE n=1 AND 2.
C
C EVALUATE L2*R2 G-TYPE INTERMEDIATES AND PLACE ON LISTS 91 AND 92
C
      CALL GFORMG(IRREPXL,IRREPXR,LISTL2,LISTR2,LISTGRL,SCR,MXCOR,
     &   LISTGRLOF,ONEM,IUHF)
C
C EVALUATE L2*T2 G-TYPE INTERMEDIATES AND PLACE ON LISTS 491 AND 492
C
      CALL GFORMG(IRREPXL,1,LISTL2,44,LISTGTL,SCR,MXCOR,LISTGTLOF,ONEM,
     &   IUHF)
CC In all terms below R0 is set to 0
CC L0 = Lambda0 = 1
CC ZNORM = <0|LR|0> is set to 0... since we require (Hbar R)c, there can be no such term
C OCCUPIED-VIRTUAL TERMS
C R fully contracted.  Need R to have an open line
c      CALL GDENSOV(IRREPXL,IRREPXR,IRREPX,DOV,ZILCH,SCR,MXCOR,IUHF,
c     &   LISTR1,LISTL1,LISTR1OFF,LISTL1OFF,LISTL2RS)
C
C VIRTUAL-VIRTUAL AND OCCUPIED-OCCUPIED TERMS
C
      CALL GDENS1 (IRREPXL,IRREPXR,IRREPX,DOO,DVV,DOV,ZILCH,SCR,MXCOR,
     &   IUHF,LISTGRL,LISTGRLOF,LISTR1,LISTL1,LISTR1OFF,LISTL1OFF,
     &   LISTT1,LISTT1OFF)

C
C VIRTUAL-OCCUPIED TERMS
C
      if (nonhf)
     &   CALL GDENSVO(IRREPXL,IRREPXR,IRREPX,DVO,DOV,ZILCH,ONE,ZILCH,
     &                SCR,MXCOR,IUHF,LISTGRL,LISTGTL,LISTGRLOF,
     &                LISTGTLOF,LISTTMP,LISTTMPOF,LISTR1,LISTL1,
     &                LISTR1OFF,LISTL1OFF,LISTR2RS)
C
      RETURN
      END

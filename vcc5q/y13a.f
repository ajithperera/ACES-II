      SUBROUTINE Y13A(CORE,MAXCOR,IUHF)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INTEGER DISSIZW,DISSIZT,DISSIZY,SIZAAO,SIZAAV,SIZBBO,SIZBBV
      INTEGER POP,VRT,DIRPRD
      DIMENSION CORE(1)
      DIMENSION SIZAAO(8),SIZAAV(8),SIZBBO(8),SIZBBV(8)
C
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /SYM/    POP(8,2),VRT(8,2),NT(2),NFMI(2),NFEA(2)
      COMMON /SYMPOP/ IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON /SYMINF/ NSTART,NIRREP,IRREPS(255,2),DIRPRD(8,8)
      COMMON /INFO/   NOCA,NOCB,NVRTA,NVRTB
      COMMON /T3OFF/  IOFFVV(8,8,10),IOFFOO(8,8,10),IOFFVO(8,8,4)
C
      INDEX(I) = I * (I-1)/2
C
      WRITE(6,1000)
 1000 FORMAT(' @Y13A-I, T2 * Y3 contributions. ')
C
      DO   20 IRREP=1,NIRREP
      SIZAAO(IRREP) = 0
      SIZAAV(IRREP) = 0
      SIZBBO(IRREP) = 0
      SIZBBV(IRREP) = 0
C
      DO   10 JRREP=1,NIRREP
      KRREP=DIRPRD(IRREP,JRREP)
C
      SIZAAO(IRREP) = SIZAAO(IRREP) + POP(JRREP,1)*POP(KRREP,1)
      SIZAAV(IRREP) = SIZAAV(IRREP) + VRT(JRREP,1)*VRT(KRREP,1)
      SIZBBO(IRREP) = SIZBBO(IRREP) + POP(JRREP,2)*POP(KRREP,2)
      SIZBBV(IRREP) = SIZBBV(IRREP) + VRT(JRREP,2)*VRT(KRREP,2)
C
   10 CONTINUE
   20 CONTINUE
C
C     CEKM = AEJK * MACJ
C     cekm = aejk * macj
C
      DO  100 ISPIN=1,IUHF+1
C
      LEN = 0
      DO   30 IRREP=1,NIRREP
      LEN = LEN + IRPDPD(IRREP,8+ISPIN) * IRPDPD(IRREP,8+ISPIN)
   30 CONTINUE
C
      I000 = 1
      I010 = I000 + LEN
C
      IOFFY = I000
      DO   40 IRPAJ=1,NIRREP
C
      DISSIZW = IRPDPD(IRPAJ,8+ISPIN)
      NDISW   = IRPDPD(IRPAJ,8+ISPIN)
      DISSIZT = IRPDPD(IRPAJ,8+ISPIN)
      NDIST   = IRPDPD(IRPAJ,8+ISPIN)
C
      I020 = I010 + DISSIZW * NDISW
      I030 = I020 + DISSIZT * NDIST
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
 1020 FORMAT(' @Y13A-I, Insufficient memory. Need ',I15,' . Got ',I15)
      STOP 'Y13A'
      ENDIF
C
      IOFFW = I010
      IOFFT = I020
C
C     W(C,M,A,J) or W(c,m,a,j)
      CALL GETLST(CORE(IOFFW),1,NDISW,2,IRPAJ,53+ISPIN)
C     T(A,J,E,K) or T(a,j,e,k) (t(ae,jk) = -t(ae,kj))
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,33+ISPIN)
C
      CALL XGEMM('N','N',DISSIZW,NDIST,DISSIZT,
     1            -2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
C
      IOFFY = IOFFY + DISSIZW * NDIST
   40 CONTINUE
C
C     We have Y(C,M,E,K) or Y(c,m,e,k) at I000. Resort to Y(C,E,K,M) in
C     two steps.
C
      I020 = I010 + LEN
      I030 = I020 +   2 * (NOCA * NOCB + NVRTA * NVRTB)
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      CALL SSTGEN(CORE(I000),CORE(I010),LEN,
     1            VRT(1,ISPIN),POP(1,ISPIN),VRT(1,ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1432')
      CALL SSTGEN(CORE(I010),CORE(I000),LEN,
     1            VRT(1,ISPIN),POP(1,ISPIN),VRT(1,ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1324')
C
      IOFFY = I000
      DO 50 IRPKM=1,NIRREP
C
      IF(ISPIN.EQ.1)THEN
      DISSIZY = SIZAAV(IRPKM)
      NDISY   = SIZAAO(IRPKM)
      ELSE
      DISSIZY = SIZBBV(IRPKM)
      NDISY   = SIZBBO(IRPKM)
      ENDIF
      CALL GETLIST(CORE(I010),1,NDISY,2,IRPKM,18+ISPIN)
C
      CALL VADD(CORE(I010),CORE(I010),CORE(IOFFY),DISSIZY*NDISY,
     1           1.0D+00)
      CALL PUTLIST(CORE(I010),1,NDISY,2,IRPKM,18+ISPIN)
C
      IOFFY = IOFFY + DISSIZY * NDISY
C
   50 CONTINUE
  100 CONTINUE
C
C     CEKM = aEjK * MaCj
C     cekm = AeJk * mAcJ
C
      DO  200 ISPIN=1,IUHF+1
C
      LEN = 0
      DO  130 IRREP=1,NIRREP
      LEN = LEN + IRPDPD(IRREP,8+ISPIN) * IRPDPD(IRREP,8+ISPIN)
  130 CONTINUE
C
      I000 = 1
      I010 = I000 + LEN
C
      IOFFY = I000
      DO  140 IRPAJ=1,NIRREP
C
      DISSIZW = IRPDPD(IRPAJ, 8+ISPIN)
      NDISW   = IRPDPD(IRPAJ,11-ISPIN)
      DISSIZT = IRPDPD(IRPAJ, 9)
      NDIST   = IRPDPD(IRPAJ,10)
C
      I020 = I010 + DISSIZW * NDISW
      I030 = I020 + DISSIZT * NDIST
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      IOFFW = I010
      IOFFT = I020
C
C     W(C,M,a,j) or W(c,m,A,J)
      CALL GETLST(CORE(IOFFW),1,NDISW,2,IRPAJ,55+ISPIN)
C     T(E,K,a,j) or T(A,J,e,k)
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,37)
C
      IF(ISPIN.EQ.1)THEN
      CALL XGEMM('N','T',DISSIZW,DISSIZT,NDIST,
     1             2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ELSE
      CALL XGEMM('N','N',DISSIZW,NDIST,DISSIZT,
     1             2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ENDIF
C
      IF(ISPIN.EQ.1)THEN
      IOFFY = IOFFY + DISSIZW * DISSIZT
      ELSE
      IOFFY = IOFFY + DISSIZW * NDIST
      ENDIF
  140 CONTINUE
C
C     We have Y(C,M,E,K) or Y(c,m,e,k) at I000. Resort to Y(C,E,K,M) in
C     two steps.
C
      I020 = I010 + LEN
      I030 = I020 +   2 * (NOCA * NOCB + NVRTA * NVRTB)
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      CALL SSTGEN(CORE(I000),CORE(I010),LEN,
     1            VRT(1,ISPIN),POP(1,ISPIN),VRT(1,ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1432')
      CALL SSTGEN(CORE(I010),CORE(I000),LEN,
     1            VRT(1,ISPIN),POP(1,ISPIN),VRT(1,ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1324')
C
      IOFFY = I000
      DO 150 IRPKM=1,NIRREP
C
      IF(ISPIN.EQ.1)THEN
      DISSIZY = SIZAAV(IRPKM)
      NDISY   = SIZAAO(IRPKM)
      ELSE
      DISSIZY = SIZBBV(IRPKM)
      NDISY   = SIZBBO(IRPKM)
      ENDIF
      CALL GETLIST(CORE(I010),1,NDISY,2,IRPKM,18+ISPIN)
C
      CALL VADD(CORE(I010),CORE(I010),CORE(IOFFY),DISSIZY*NDISY,
     1           1.0D+00)
      CALL PUTLIST(CORE(I010),1,NDISY,2,IRPKM,18+ISPIN)
C
      IOFFY = IOFFY + DISSIZY * NDISY
C
  150 CONTINUE
  200 CONTINUE
C
C     CeKm = AejK * mACj
C     cEkM = aEJk * MacJ
C
      DO  300 ISPIN=1,IUHF+1
C
      LEN = 0
      DO  230 IRREP=1,NIRREP
      LEN = LEN + IRPDPD(IRREP,13) * IRPDPD(IRREP,14)
  230 CONTINUE
C
      I000 = 1
      I010 = I000 + LEN
C
      IOFFY = I000
      DO  240 IRPAJ=1,NIRREP
C
      DISSIZW = IRPDPD(IRPAJ,10+ISPIN)
      NDISW   = IRPDPD(IRPAJ,10+ISPIN)
      DISSIZT = IRPDPD(IRPAJ,11)
      NDIST   = IRPDPD(IRPAJ,12)
C
      I020 = I010 + DISSIZW * NDISW
      I030 = I020 + DISSIZT * NDIST
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      IOFFW = I010
      IOFFT = I020
C
C     W(C,m,A,j) or W(c,M,a,J)
      CALL GETLST(CORE(IOFFW),1,NDISW,2,IRPAJ,57+ISPIN)
C     T(A,j,e,K) or T(E,k,a,J)
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,39)
C
      IF(ISPIN.EQ.1)THEN
      CALL XGEMM('N','N',DISSIZW,NDIST,DISSIZT,
     1            -2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ELSE
      CALL XGEMM('N','T',DISSIZW,DISSIZT,NDIST,
     1            -2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ENDIF
C
      IF(ISPIN.EQ.1)THEN
      IOFFY = IOFFY + DISSIZW * NDIST
      ELSE
      IOFFY = IOFFY + DISSIZW * DISSIZT
      ENDIF
  240 CONTINUE
C
C     We have Y(C,m,e,K) or Y(c,M,E,k) at I000. Resort to Y(C,e,K,m) in
C     two steps.
C
      I020 = I010 + LEN
      I030 = I020 +   2 * (NOCA * NOCB + NVRTA * NVRTB)
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      CALL SSTGEN(CORE(I000),CORE(I010),LEN,
     1        VRT(1,ISPIN),POP(1,3-ISPIN),VRT(1,3-ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1432')
      CALL SSTGEN(CORE(I010),CORE(I000),LEN,
     1        VRT(1,ISPIN),POP(1,ISPIN),VRT(1,3-ISPIN),POP(1,3-ISPIN),
     1            CORE(I020),1,'1324')
C
      IOFFY = I000
      DO 250 IRPKM=1,NIRREP
C
      DISSIZY = IRPDPD(IRPKM,13)
      NDISY   = IRPDPD(IRPKM,14)
      CALL GETLIST(CORE(I010),1,NDISY,2,IRPKM,20+ISPIN)
C
      CALL VADD(CORE(I010),CORE(I010),CORE(IOFFY),DISSIZY*NDISY,
     1           1.0D+00)
      CALL PUTLIST(CORE(I010),1,NDISY,2,IRPKM,20+ISPIN)
C
      IOFFY = IOFFY + DISSIZY * NDISY
C
  250 CONTINUE
  300 CONTINUE
C
C     CekM = AeJk * MACJ
C     cEKm = aEjK * macj
C
      DO  400 ISPIN=1,IUHF+1
C
      LEN = 0
      DO  330 IRREP=1,NIRREP
      LEN = LEN + IRPDPD(IRREP,13) * IRPDPD(IRREP,14)
  330 CONTINUE
C
      I000 = 1
      I010 = I000 + LEN
C
      IOFFY = I000
      DO  340 IRPAJ=1,NIRREP
C
      DISSIZW = IRPDPD(IRPAJ, 8+ISPIN)
      NDISW   = IRPDPD(IRPAJ, 8+ISPIN)
      DISSIZT = IRPDPD(IRPAJ, 9)
      NDIST   = IRPDPD(IRPAJ,10)
C
      I020 = I010 + DISSIZW * NDISW
      I030 = I020 + DISSIZT * NDIST
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      IOFFW = I010
      IOFFT = I020
C
C     W(C,M,A,J) or W(c,m,a,j)
      CALL GETLST(CORE(IOFFW),1,NDISW,2,IRPAJ,53+ISPIN)
C     T(A,J,e,k) or T(E,K,a,j)
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,37)
C
      IF(ISPIN.EQ.1)THEN
      CALL XGEMM('N','N',DISSIZW,NDIST,DISSIZT,
     1             2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ELSE
      CALL XGEMM('N','T',DISSIZW,DISSIZT,NDIST,
     1             2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
      ENDIF
C
      IF(ISPIN.EQ.1)THEN
      IOFFY = IOFFY + DISSIZW * NDIST
      ELSE
      IOFFY = IOFFY + DISSIZW * DISSIZT
      ENDIF
  340 CONTINUE
C
C     We have Y(C,M,e,k) or Y(c,m,E,K) at I000. Resort to Y(C,e,k,M) in
C     two steps.
C
      I020 = I010 + LEN
      I030 = I020 +   2 * (NOCA * NOCB + NVRTA * NVRTB)
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      CALL SSTGEN(CORE(I000),CORE(I010),LEN,
     1        VRT(1,ISPIN),POP(1,ISPIN),VRT(1,3-ISPIN),POP(1,3-ISPIN),
     1            CORE(I020),1,'1432')
      CALL SSTGEN(CORE(I010),CORE(I000),LEN,
     1        VRT(1,ISPIN),POP(1,3-ISPIN),VRT(1,3-ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1324')
C
      IOFFY = I000
      DO 350 IRPKM=1,NIRREP
C
      DISSIZY = IRPDPD(IRPKM,13)
      NDISY   = IRPDPD(IRPKM,14)
      CALL GETLIST(CORE(I010),1,NDISY,2,IRPKM,22+ISPIN)
C
      CALL VADD(CORE(I010),CORE(I010),CORE(IOFFY),DISSIZY*NDISY,
     1           1.0D+00)
      CALL PUTLIST(CORE(I010),1,NDISY,2,IRPKM,22+ISPIN)
C
      IOFFY = IOFFY + DISSIZY * NDISY
C
  350 CONTINUE
  400 CONTINUE
C
C     CekM = aejk * MaCj
C     cEKm = AEJK * mAcJ
C
      DO  500 ISPIN=1,IUHF+1
C
      LEN = 0
      DO  430 IRREP=1,NIRREP
      LEN = LEN + IRPDPD(IRREP,13) * IRPDPD(IRREP,14)
  430 CONTINUE
C
      I000 = 1
      I010 = I000 + LEN
C
      IOFFY = I000
      DO  440 IRPAJ=1,NIRREP
C
      DISSIZW = IRPDPD(IRPAJ, 8+ISPIN)
      NDISW   = IRPDPD(IRPAJ,11-ISPIN)
      DISSIZT = IRPDPD(IRPAJ,11-ISPIN)
      NDIST   = IRPDPD(IRPAJ,11-ISPIN)
C
      I020 = I010 + DISSIZW * NDISW
      I030 = I020 + DISSIZT * NDIST
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      IOFFW = I010
      IOFFT = I020
C
C     W(C,M,a,j) or W(c,m,A,J)
      CALL GETLST(CORE(IOFFW),1,NDISW,2,IRPAJ,55+ISPIN)
C     T(a,j,e,k) or T(A,J,E,K) (t(ae,jk) = -t(ae,kj))
      IF(IUHF.GT.0)THEN
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,36-ISPIN)
      ELSE
      CALL GETLST(CORE(IOFFT),1,NDIST,1,IRPAJ,34)
      ENDIF
C
      CALL XGEMM('N','N',DISSIZW,NDIST,DISSIZT,
     1            -2.0D+00,
     1            CORE(IOFFW),DISSIZW,
     1            CORE(IOFFT),DISSIZT,0.0D+00,
     1            CORE(IOFFY),DISSIZW)
C
      IOFFY = IOFFY + DISSIZW * NDIST
  440 CONTINUE
C
C     We have Y(C,M,e,k) or Y(c,m,E,K) at I000. Resort to Y(C,e,k,M) in
C     two steps.
C
      I020 = I010 + LEN
      I030 = I020 +   2 * (NOCA * NOCB + NVRTA * NVRTB)
      NEED = IINTFP * I030
      IF(NEED.GT.MAXCOR)THEN
      WRITE(6,1020) NEED,MAXCOR
      STOP 'Y13A'
      ENDIF
C
      CALL SSTGEN(CORE(I000),CORE(I010),LEN,
     1        VRT(1,ISPIN),POP(1,ISPIN),VRT(1,3-ISPIN),POP(1,3-ISPIN),
     1            CORE(I020),1,'1432')
      CALL SSTGEN(CORE(I010),CORE(I000),LEN,
     1        VRT(1,ISPIN),POP(1,3-ISPIN),VRT(1,3-ISPIN),POP(1,ISPIN),
     1            CORE(I020),1,'1324')
C
      IOFFY = I000
      DO 450 IRPKM=1,NIRREP
C
      DISSIZY = IRPDPD(IRPKM,13)
      NDISY   = IRPDPD(IRPKM,14)
      CALL GETLIST(CORE(I010),1,NDISY,2,IRPKM,22+ISPIN)
C
      CALL VADD(CORE(I010),CORE(I010),CORE(IOFFY),DISSIZY*NDISY,
     1           1.0D+00)
      CALL PUTLIST(CORE(I010),1,NDISY,2,IRPKM,22+ISPIN)
C
      IOFFY = IOFFY + DISSIZY * NDISY
C
  450 CONTINUE
  500 CONTINUE
      RETURN
      END

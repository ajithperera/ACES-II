      SUBROUTINE E4SENG(W,D,DEN,E,NTSIZ,POP,VRT,NOCC,NVRT,SE4,ISPIN)
C
C     THIS ROUTINE CALCULATES THE NEW T1 AMPLITUDES AND
C     FOR FOURTH ORDER PERTURBATION THEORY THE SINGLE
C     CONTRIBUTION TO THE ENERGY
C
C     THIS ROUTINE HAS TO BE CALLED SEPARATELY FOR ALPHA AND BETA
C     CASE

      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL LINCC,CICALC
      INTEGER DIRPRD,POP,VRT
cjp
      integer itrue,atrue,intptr
      DIMENSION W(NTSIZ),E(NOCC+NVRT),
     &          D(NTSIZ),DEN(NTSIZ),POP(8),VRT(8)
      COMMON /MACHSP/ IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON /FILES/ LUOUT,MOINTS
      COMMON /SYMINF/ NSTART,NIRREP,IRREPA(255),IRREPB(255),
     &                DIRPRD(8,8)
      COMMON /FLAGS/ IFLAGS(100)
      COMMON /LINEAR/ LINCC,CICALC
      COMMON /CORENG/ ELAST
C
      EQUIVALENCE(IFLAGS(2),METHOD)
C
C GET ORBITAL ENERGIES FROM DISK
C
      IF(ISPIN.EQ.1)THEN
       CALL GETREC(20,'JOBARC','SCFEVALA',IINTFP*(NOCC + NVRT),
     &             E)
      ELSE
       CALL GETREC(20,'JOBARC','SCFEVALB',IINTFP*(NOCC + NVRT),
     &             E)
      ENDIF
C
C LOOP OVER IRREPS 
C
      IND=0
      INDI=0
      INDA0=0
C
      DO IRREP=1,NIRREP
C
         NOCCI=POP(IRREP)
         NVRTI=VRT(IRREP)
c
         DO I=1,NOCCI
            INDI=INDI+1
            INDA=INDA0
            DO IA=1,NVRTI
               INDA=INDA+1
               IND=IND+1
               DEN(IND) = E(INDI) - E(NOCC + INDA)
            ENDDO
        ENDDO
        INDA0=INDA0+NVRTI
C
      ENDDO
C
      FACT=0.0
      DO I=1,NTSIZ
C
         tmp=1.d0/(DEN(I)+FACT)
         D(I)=W(I)*tmp
      ENDDO
C
       SE4=SE4+SDOT(NTSIZ,D,1,W,1)
C
      RETURN
      END

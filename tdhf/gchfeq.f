      SUBROUTINE GCHFEQ(SCR,EVAL,EVEC,DEN,FP,HMO
     X ,U1,U2,F1,F2,E1,E2,UPDATE,ASMALL,ASQUARE,ASCALE,ICONV
     X ,XX,IX,NINTMX,ABMX,ABVEC,ABVEC1,UVEC,IVO,IVOS,IVRT,IOCC,
     X IVRTS,IOCCS,IA,IAS,ISYMO,LCOMP,NCOMP)
C
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION SCR(1),EVAL(1),EVEC(1)
     X ,DEN(1),FP(1),IA(1),HMO(1)
     X ,F1(1),F2(1),E1(1),E2(1)
      DIMENSION U1(1),U2(1)
      DIMENSION XX(1),IX(1)
      DIMENSION ABVEC(1),ABVEC1(1)
      DIMENSION ABMX(1),UVEC(1),IVO(1),IVRT(1),IOCC(1)
      DIMENSION IAS(1),IVRTS(1),IOCCS(1),IVOS(1),ISYMO(1)
      DIMENSION ENRG(3,6),LCOMP(21,4)
C ... for reduced linear equation solver
      DIMENSION UPDATE(1),ASMALL(1),ASQUARE(1),ASCALE(1),ICONV(1)
C ..............................
      COMMON/SWPPP/INP,IAMO,IFAMO,IINDO,IORTH
      COMMON/INFOA/NBASIS,NUMSCF,NX,NMO2,NOC,NVT,NVO
      COMMON/THRES/ TOLPER,DEGEN,EPSI
      COMMON/THRE1/ NITER,MAXIT
      COMMON/ILINEA/ISALPH,IDALPH
      COMMON/INBETA/ISBETA,ISHG,IEOPE,IOR
      COMMON/CONST/ EBETA,EGAMMA
      COMMON/INFSYM/NSYMHF,NSO(8),NOCS(8),NVTS(8),IDPR(8,8),NVOS(8)
     X ,NIJS(8),NIJS2(8),NRDS(8),NIJSR(8)
      COMMON /TIMEINFO/ TIMEIN, TIMENOW, TIMETOT, TIMENEW
C
      DATA ZERO/0.D0/,ONE/1.D0/,HALF/.5D0/,TWO/2.D0/
      DATA OCTH/1.D-8/
      NSIZ1=NUMSCF
      NSIZ3=(NBASIS+1)*NBASIS/2
      NSIZO=NOC
      NSIZVO=NVO
      NSIZIV=NSIZVO+3*2
      CALL TIMER(0)
      IF(IFAMO.EQ.0) THEN
C     Create MO drive fock matrix generator that is A+B matrix   ......
      CALL CPHFSX(ABMX,XX,IX,IVO,IVOS,ISYMO,NINTMX,NSYMHF
     X ,NUMSCF,NOC)
      CALL TIMER(1)
      WRITE(6,*) 'for CPHFMX ',TIMENEW
      END IF
C  .... linear equation solving .......
      CALL ABSOLS(U1,ABMX,ABVEC,ABVEC1,UVEC,SCR,IVRT,IOCC,IVRTS,IOCCS
     X ,DEN,FP,F1,E1,IA,HMO,EVAL,EVEC,ENRG,UPDATE,ASMALL,ASQUARE,ASCALE
     X ,ICONV,3,0,XX,IX,NSYMHF,NUMSCF,NSIZ3,NOC,NVO,NINTMX)
      CALL TIMER(1)
C     WRITE(6,*) 'for ABSOLV ',TIMENEW
C ................................
C     write(6,*) ' U1 '
C     CALL OUTMXD(U1,NSIZ1,NUMSCF,NOC)
      CALL BSTAT(F1,E1,U1,NSIZ1,NSZIO)
      IF(ISBETA.EQ.0) THEN
      CALL CONST2(F1,E1,U1,U1,E2,DEN,FP,U2,F2,EVAL,EVEC,ENRG,
     X HMO,6,XX,IX,NINTMX,IA,IVRT,IOCC,NSIZ1,NSIZ3,NSIZO)
      CALL TIMER(1)
      WRITE(6,*) 'for CONST2 ',TIMENEW
      CALL UGEN(U2,ABMX,ABVEC,ABVEC1,IVRT,IOCC,IVRTS,IOCCS,DEN,FP,F2
     X ,EVAL,EVEC,ENRG,UPDATE,ASMALL,ASQUARE,ASCALE,ICONV,IA,HMO,E2,
     X 6,XX,IX,NSYMHF,NSIZ1,NSIZ3,NSIZO,NVO,NINTMX)
      CALL TIMER(1)
      WRITE(6,*) 'for UGEN ',TIMENEW
      BXXX=3.D0*ENRG(1,1)+ENRG(1,2)+ENRG(2,4)+ENRG(2,4)
     X                   +ENRG(1,3)+ENRG(3,6)+ENRG(3,6)
      BXXX=BXXX/5.D0
      BYYY=3.D0*ENRG(2,2)+ENRG(2,1)+ENRG(1,4)+ENRG(1,4)
     X                   +ENRG(2,3)+ENRG(3,5)+ENRG(3,5)
      BYYY=BYYY/5.D0
      BZZZ=3.D0*ENRG(3,3)+ENRG(3,1)+ENRG(1,6)+ENRG(1,6)
     X                   +ENRG(3,2)+ENRG(2,5)+ENRG(2,5)
      BZZZ=BZZZ/5.D0
      WRITE(6,*) ' Second Order Hyperpolarizabilities '
      WRITE(6,*) ' Parallel (x,y,z)  '
      WRITE(6,*) BXXX,BYYY,BZZZ,' a.u. '
      WRITE(6,*) ' By Kleinman symmetry, perpendicular components
     X  are 1/3 of that of Parallel. '
      BXESU=BXXX*EBETA
      BYESU=BYYY*EBETA
      BZESU=BZZZ*EBETA
      WRITE(6,*) ' Beta in e.s.u. ',BXESU,BYESU,BZESU
      WRITE(6,*) ' >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '
      WRITE(6,*) ' THIRD ORDER HYPERPOLARIZABILITIES '
      WRITE(6,*) ' >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '
      CALL GSTAT(F1,F2,E1,E2,U1,U2,LCOMP,NCOMP,NUMSCF,NSIZ3,NOC)
      CALL TIMER(1)
      WRITE(6,*) 'for GSTAT ',TIMENEW
 1000 FORMAT(9F14.8)
      END IF
      RETURN
      END

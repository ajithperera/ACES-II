      SUBROUTINE MKAQRHF2(AMAT,SCRATCH, ISPIN)
C
C THIS ROUTINE FORMS THE IRREP=1 LIST OF <AB||IJ> INTEGRALS
C FOR ORDERING W(AI,BJ).  THIS ROUTINE IS ONLY REQUIRED
C FOR QRHF-CCSD GRADIENT CALCULATIONS.  THE TRICK HERE IS THAT
C A,B,I AND J REFER TO THE CLOSED-SHELL RHF REFERENCE, AND NOT
C THE COMPUTATIONAL QRHF REFERENCE.
C
CEND
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL QRHFM,QRHFP
      INTEGER POP,VRT,POPRHF,VRTRHF,POPDOC,VRTDOC,DIRPRD
      DIMENSION AMAT(1),SCRATCH(1)
      COMMON/QRHFINF/POPRHF(8),VRTRHF(8),NOSH1(8),NOSH2(8),
     &               POPDOC(8),VRTDOC(8),NAI,N1I,NA2,
     &               NUMISCF,NUMASCF
      COMMON/INFO/NOCCO(2),NVRTO(2)
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON/SYMINF/NSTART,NIRREP,IRREPA(255,2),DIRPRD(8,8)
      COMMON/SYMPOP/IRPDPD(8,22),ISYTYP(2,500),NTOT(18)
      COMMON/SYM/POP(8,2),VRT(8,2),NJUNK(6)
      COMMON/FLAGS/IFLAGS(100)
C
      DATA ONE,ONEM,TWO /1.0D+0,-1.0D+0,2.0D+0/
C
C FIRST DETERMINE IF THERE ARE NO QRHF_M OR QRHF_P ORBITALS
C ANYWHERE
C
      QRHFM=.FALSE.
      QRHFP=.FALSE.
      DO 10 IRREP=1,NIRREP
       IF(NOSH1(IRREP).NE.0)QRHFP=.TRUE.
       IF(NOSH2(IRREP).NE.0)QRHFM=.TRUE.
10    CONTINUE
C
C IF THERE ARE ONLY QRHFP OR ONLY QRHFM ORBITALS, THEN THIS
C CODE IS RELATIVELY STRAIGHTFORWARD.  DEAL WITH THESE EXAMPLES
C FIRST AND CODE THE MIXED CASES SOME DAY WHEN I FEEL PARTICULARLY
C MASOCHISTIC.
C
      IF(.NOT.QRHFM.OR..NOT.QRHFP)THEN
C
       IF(QRHFP)THEN
C
C IF ONLY QRHFP ORBITALS, THEN AAAA CASE IS SIMPLE, REQUIRING ONLY
C THE ALL ALPHA INTEGRALS.
C
        LISTW1=19
        LISTW2=23
        IOFFA = 1
        NUMDIS=IRPDPD(1,ISYTYP(1,LISTW1))
        DISSIZ=IRPDPD(1,ISYTYP(2,LISTW1))
        LENGTH=NUMDIS*DISSIZ

C <AB||IJ> + <IA||JB> (stored as AI;BJ and IB;AJ)

        CALL GETLST(AMAT(IOFFA),1,NUMDIS,1,1,LISTW1)
        CALL GETLST(SCRATCH,1,NUMDIS,1,1,LISTW2)
        CALL SAXPY(LENGTH,ONEM,SCRATCH,1,AMAT(IOFFA),1)

        IOFFA=1+NUMDIS*DISSIZ
C
C NOW FILL OUT A MATRIX WITH <AB|IJ> [*NOT* ANTISYMMETRIZED, ORDERED
C W(AI,BJ), ALPHA SPIN CASE] FROM LIST 5.  
C
        LISTW=5
        NUMDIS=IRPDPD(1,ISYTYP(1,LISTW))
        DISSIZ=IRPDPD(1,ISYTYP(2,LISTW))
        LENGTH=NUMDIS*DISSIZ
        CALL GETLST(AMAT(IOFFA),1,NUMDIS,1,1,LISTW)
        CALL SSCAL (LENGTH,TWO,AMAT(IOFFA),1)

        IOFFA=1+NUMDIS*DISSIZ

C The BBBB blocks. There is no check for UHF since it is expected.

C First straightforward BBBB blocks. Elements are <ab||ij> + <ai|bj>
            
        LISTW1 = 20
        LISTW2 = 24
        NUMDIS=IRPDPD(1,ISYTYP(1,LISTW1))
        DISSIZ=IRPDPD(1,ISYTYP(2,LISTW1))

        CALL GETLST(AMAT(IOFFA),1,NUMDIS,1,1,LISTW1)
        CALL GETLST(SCRATCH,1,NUMDIS,1,1,LISTW2)
        CALL SAXPY(LENGTH,ONEM,SCRATCH,1,AMAT(IOFFA),1)
C         
        

C 

C Now ABAB blocks

       ELSEIF(QRHFM)THEN
C
C SIMILARLY, CASES WITH ONLY QRHFM ORBITALS REQUIRE ONLY THE ALL BETA
C INTEGRALS.
C
        LISTW1=20
        LISTW2=24
        NUMDIS=IRPDPD(1,ISYTYP(1,LISTW1))
        DISSIZ=IRPDPD(1,ISYTYP(2,LISTW1))
        LENGTH=NUMDIS*DISSIZ
        CALL GETLST(AMAT,1,NUMDIS,1,1,LISTW1)
        CALL GETLST(SCRATCH,1,NUMDIS,1,1,LISTW2)
        CALL SAXPY(LENGTH,ONEM,SCRATCH,1,AMAT,1)
        IOFFA=1+NUMDIS*DISSIZ
C
C NOW FILL OUT A MATRIX WITH <AB|IJ> [*NOT* ANTISYMMETRIZED, ORDERED
C W(AI,BJ), ALPHA SPIN CASE] FROM LIST 6.  
C
        LISTW=6
        NUMDIS=IRPDPD(1,ISYTYP(1,LISTW))
        DISSIZ=IRPDPD(1,ISYTYP(2,LISTW))
        LENGTH=NUMDIS*DISSIZ
        CALL GETLST(AMAT(IOFFA),1,NUMDIS,1,1,LISTW)
        CALL SSCAL (LENGTH,TWO,AMAT(IOFFA),1)
C
       ENDIF
C
      ELSE
       WRITE(6,*)' screw off.  mixed open-shell cases not yet ',
     &                ' coded!'
       CALL ERREX
      ENDIF
C
      RETURN
      END

      SUBROUTINE ROHFDEN(XOVA,XOVB)
C
C  THIS SUBROUTINE FORMS THE DENSITY MATRICES
C  REQUIRED FOR GRADIENT CALCULATIONS.
C
C   DTOTAL(A,I) = DCC(A,I) + 1/2 [ DORB(A,I) + DORB(a,i)]
C   DTOTAL(a,i) = DCC(a,i) + 1/2 [ DORB(A<I) + DORB(a.i)]
C   DTOTAL(A,1) = DCC(A,1) + DORB(A,1)
C   DTOTAL(1,i) = DCC(1,i) + DORB(1,i)
C
C FOR A THOROUGH THEORETICAL DISCUSSION, SEE
C
C  W.J. LAUDERDALE, J. GAUSS, J.F. STANTON, AND R.J. BARTLETT,
C  CHEM. PHYS. LETTER, TO BE PUBLISHED.
C
CEND
C
C   CODED FEB/91 JG
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER POP,VRT,DIRPRD
C
      DIMENSION XOVA(1),XOVB(1)
C
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON/SYM/POP(8,2),VRT(8,2),NT(2),NF1(2),NF2(2)
      COMMON/SYMINF/NSTART,NIRREP,IRREPA(255,2),DIRPRD(8,8)
C
      DATA HALF,ONE /0.5D0,1.0D0/
C
C  LOOP FIRST OVER ALL IRREPS
C
      IOFFA=1
      IOFFB=1
C
      DO 100 IRREP=1,NIRREP
C
       POPA=POP(IRREP,1)
       POPB=POP(IRREP,2)
       VRTA=VRT(IRREP,1)
       VRTB=VRT(IRREP,2)
C
       IF(POPA.EQ.POPB) THEN
C
C  IN THIS CASE, THERE IS NO OPEN-SHELL ORBITAL IN THIS IRREP
C
C  SIMPLY ADD BOTH TERMS
C
        N=POPA*VRTA
        CALL SAXPY(N,ONE,XOVA(IOFFA),1,XOVB(IOFFB),1)
        CALL SSCAL(N,HALF,XOVB(IOFFB),1)
c YAU : old
c       CALL ICOPY(N*IINTFP,XOVB(IOFFB),1,XOVA(IOFFA),1)
c YAU : new
        CALL DCOPY(N,XOVB(IOFFB),1,XOVA(IOFFA),1)
c YAU : end
C
       ELSE 
C
C  HERE WE HAVE TO DEAL WITH OPEN-SHELL ORBITALS
C  NOTE, THAT THE OPEN-SHELL ORBITALS ARE ALWAYS AT THE TOP
C  OF THE OCCUPIED AND AT THE BOTTOM OF THE VIRTUAL ORBITALS.
C
C   POPB.... NUMBER OF DOUBLY OCCUPIED ORBITALS
C   VRTA.... NUMBER OF VIRTUAL ORBITALS
C   POPA-POPB = VRTB-VRTA ... NUMBER OF OPEN-SHELL ORBITALS 
C
C   LOOP OVER DOUBLY OCCUPIED ORBITALS
C
        IOFFA1=IOFFA
        IOFFB1=IOFFB
C
        DO 10 IDOCC=1,POPB
C
         CALL SAXPY(VRTA,ONE,XOVA(IOFFA1),1,XOVB(IOFFB1),1)
         CALL SSCAL(VRTA,HALF,XOVB(IOFFB1),1)
c YAU : old
c        CALL ICOPY(VRTA*IINTFP,XOVB(IOFFB1),1,XOVA(IOFFA1),1)
c YAU : new
         CALL DCOPY(VRTA,XOVB(IOFFB1),1,XOVA(IOFFA1),1)
c YAU : end
C
         IOFFA1=IOFFA1+VRTA
         IOFFB1=IOFFB1+VRTB
C
10      CONTINUE
C
       ENDIF
C
       IOFFA=IOFFA+POPA*VRTA
       IOFFB=IOFFB+POPB*VRTB
C
100   CONTINUE
C
      RETURN
      END
